(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var AnnotationSync,extend,slice=[].slice;extend=require("extend"),module.exports=AnnotationSync=function(){function t(t,n){var e,o,r,i,a,s,u;this.bridge=t,this.options=extend(!0,{},this.options,n),this.cache={},this._on=this.options.on,this._emit=this.options.emit,s=this._eventListeners;for(e in s)r=s[e],this._on(e,r.bind(this));u=this._channelListeners;for(i in u)o=u[i],this.bridge.on(i,o.bind(this));a=function(t){return function(n){return t._syncCache(n)}}(this),this.bridge.onConnect(a)}return t.prototype.options={formatter:function(t){return t},parser:function(t){return t},merge:function(t,n){var e,o;for(e in n)o=n[e],t[e]=o;return t},emit:function(){var t,n;throw n=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],new Error("options.emit unspecified for AnnotationSync.")},on:function(t,n){throw new Error("options.on unspecified for AnnotationSync.")}},t.prototype.cache=null,t.prototype.getAnnotationForTag=function(t){return this.cache[t]||null},t.prototype.sync=function(t){var n;return t=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],r.push(this._format(n));return r}.call(this),this.bridge.call("sync",t,function(t){return function(e,o){var r,i,a;for(null==o&&(o=[]),a=[],r=0,i=o.length;i>r;r++)n=o[r],a.push(t._parse(n));return a}}(this)),this},t.prototype._channelListeners={beforeCreateAnnotation:function(t,n){var e;return e=this._parse(t),delete this.cache[e.$$tag],this._emit("beforeAnnotationCreated",e),this.cache[e.$$tag]=e,n(null,this._format(e))},createAnnotation:function(t,n){var e;return e=this._parse(t),delete this.cache[e.$$tag],this._emit("annotationCreated",e),this.cache[e.$$tag]=e,n(null,this._format(e))},updateAnnotation:function(t,n){var e;return e=this._parse(t),delete this.cache[e.$$tag],this._emit("beforeAnnotationUpdated",e),this._emit("annotationUpdated",e),this.cache[e.$$tag]=e,n(null,this._format(e))},deleteAnnotation:function(t,n){var e;return e=this._parse(t),delete this.cache[e.$$tag],this._emit("annotationDeleted",e),n(null,this._format(e))},loadAnnotations:function(t,n){var e,o;return o=function(){var n,o,r;for(r=[],n=0,o=t.length;o>n;n++)e=t[n],r.push(this._parse(e));return r}.call(this),this._emit("annotationsLoaded",o),n(null,o)},sync:function(t,n){var e,o;return e=function(){var n,e,r;for(r=[],n=0,e=t.length;e>n;n++)o=t[n],r.push(this._format(this._parse(o)));return r}.call(this),this._emit("sync",e),n(null,e)}},t.prototype._eventListeners={beforeAnnotationCreated:function(t){return null==t.$$tag?this._mkCallRemotelyAndParseResults("beforeCreateAnnotation")(t):void 0},annotationCreated:function(t){return null!=t.$$tag&&this.cache[t.$$tag]?this._mkCallRemotelyAndParseResults("createAnnotation")(t):void 0},annotationUpdated:function(t){return null!=t.$$tag&&this.cache[t.$$tag]?this._mkCallRemotelyAndParseResults("updateAnnotation")(t):void 0},annotationDeleted:function(t){var n;if(null!=t.$$tag&&this.cache[t.$$tag])return n=function(n){return function(e){return e?void 0:delete n.cache[t.$$tag]}}(this),this._mkCallRemotelyAndParseResults("deleteAnnotation",n)(t)},annotationsLoaded:function(t){var n,e;return e=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],n.$$tag||r.push(this._format(n));return r}.call(this),e.length?this.bridge.call("loadAnnotations",e):void 0},annotationsUnloaded:function(t){var n;return n=this,t.forEach(function(t){return delete n.cache[t.$$tag],n._mkCallRemotelyAndParseResults("deleteAnnotation")(t)})}},t.prototype._syncCache=function(t){var n,e,o;return e=function(){var t,e;t=this.cache,e=[];for(o in t)n=t[o],e.push(this._format(n));return e}.call(this),e.length?t.call("loadAnnotations",e):void 0},t.prototype._mkCallRemotelyAndParseResults=function(t,n){return function(e){return function(o){var r;return r=function(t,o){return null==t&&e._parseResults(o),"function"==typeof n?n(t,o):void 0},e.bridge.call(t,e._format(o),r)}}(this)},t.prototype._parseResults=function(t){var n,e,o,r,i,a;for(o=0,i=t.length;i>o;o++)for(n=t[o],n=[].concat(n),r=0,a=n.length;a>r;r++)e=n[r],null!==e&&this._parse(e)},t.prototype._tag=function(t,n){return t.$$tag?t:(n=n||window.btoa(Math.random()),Object.defineProperty(t,"$$tag",{value:n}),this.cache[n]=t,t)},t.prototype._parse=function(t){var n,e,o;return n=this.cache[t.tag],o=this.options.parser(t.msg),e=null!=n?this.options.merge(n,o):o,this._tag(e,t.tag)},t.prototype._format=function(t){return this._tag(t),{tag:t.$$tag,msg:this.options.formatter(t)}},t}();

},{"extend":55}],2:[function(require,module,exports){
module.exports='<hypothesis-adder class="annotator-adder">\n    <hypothesis-adder-actions class="annotator-adder-actions">\n      <button class="annotator-adder-actions__button h-icon-annotate" data-action="comment">\n        <span class="annotator-adder-actions__label" data-action="comment">Annotate</span>\n      </button>\n      <button class="annotator-adder-actions__button h-icon-highlight" data-action="highlight">\n        <span class="annotator-adder-actions__label" data-action="highlight">Highlight</span>\n      </button>\n    </hypothesis-adder-actions>\n</hypothesis-adder>\n';

},{}],3:[function(require,module,exports){
"use strict";function template(){return require("./adder.html")}function toPx(t){return t.toString()+"px"}function Adder(t){function e(){return t.getBoundingClientRect().width}function i(){return t.getBoundingClientRect().height}this.element=t;var n=t.ownerDocument.defaultView;t.style.display="block",t.style.visibility="hidden",this.hide=function(){t.style.visibility="hidden"},this.target=function(t,O){var a;a=O?ARROW_POINTING_DOWN:ARROW_POINTING_UP;var r,R,N=Math.min(ARROW_H_MARGIN,t.width);return R=O?t.left-e()/2+N:t.left+t.width-e()/2-N,t.top-i()<n.pageYOffset&&a===ARROW_POINTING_DOWN?a=ARROW_POINTING_UP:t.top+i()>n.pageYOffset+n.innerHeight&&(a=ARROW_POINTING_DOWN),r=a===ARROW_POINTING_UP?t.top+t.height+ARROW_HEIGHT:t.top-i()-ARROW_HEIGHT,R=Math.max(R,n.pageXOffset),R=Math.min(R,n.pageXOffset+n.innerWidth-e()),r=Math.max(r,n.pageYOffset),r=Math.min(r,n.pageYOffset+n.innerHeight-i()),{top:r,left:R,arrowDirection:a}},this.showAt=function(e,i,n){t.className=classnames({"annotator-adder":!0,"annotator-adder--arrow-down":n===ARROW_POINTING_DOWN,"annotator-adder--arrow-up":n===ARROW_POINTING_UP}),t.style.top=toPx(i),t.style.left=toPx(e),t.style.visibility="visible"}}var classnames=require("classnames"),ARROW_POINTING_DOWN=1,ARROW_POINTING_UP=2,ARROW_HEIGHT=10,ARROW_H_MARGIN=20;module.exports={ARROW_POINTING_DOWN:ARROW_POINTING_DOWN,ARROW_POINTING_UP:ARROW_POINTING_UP,template:template,Adder:Adder};

},{"./adder.html":2,"classnames":28}],4:[function(require,module,exports){
var FragmentAnchor,RangeAnchor,TextPositionAnchor,TextQuoteAnchor,querySelector,ref;ref=require("./types"),FragmentAnchor=ref.FragmentAnchor,RangeAnchor=ref.RangeAnchor,TextPositionAnchor=ref.TextPositionAnchor,TextQuoteAnchor=ref.TextQuoteAnchor,querySelector=function(e,r,n,t){var o;return o=function(o,c){var u,l,a,h;try{return u=e.fromSelector(r,n,t),h=u.toRange(t),o(h)}catch(a){return l=a,c(l)}},new Promise(o)},exports.anchor=function(e,r,n){var t,o,c,u,l,a,h,i,f,s;for(null==n&&(n={}),t=null,l=null,h=null,i=null,f=null!=r?r:[],o=0,c=f.length;c>o;o++)switch(s=f[o],s.type){case"FragmentSelector":t=s;break;case"TextPositionSelector":l=s,n.hint=l.start;break;case"TextQuoteSelector":h=s;break;case"RangeSelector":i=s}return u=function(e){if(null!=(null!=h?h.exact:void 0)&&e.toString()!==h.exact)throw new Error("quote mismatch");return e},a=Promise.reject("unable to anchor"),null!=t&&(a=a["catch"](function(){return querySelector(FragmentAnchor,e,t,n).then(u)})),null!=i&&(a=a["catch"](function(){return querySelector(RangeAnchor,e,i,n).then(u)})),null!=l&&(a=a["catch"](function(){return querySelector(TextPositionAnchor,e,l,n).then(u)})),null!=h&&(a=a["catch"](function(){return querySelector(TextQuoteAnchor,e,h,n)})),a},exports.describe=function(e,r,n){var t,o,c,u,l;return null==n&&(n={}),l=[FragmentAnchor,RangeAnchor,TextPositionAnchor,TextQuoteAnchor],c=function(){var c,a,h;for(h=[],c=0,a=l.length;a>c;c++){u=l[c];try{t=u.fromRange(e,r,n),h.push(o=t.toSelector(n))}catch(i){continue}}return h}()};

},{"./types":6}],5:[function(require,module,exports){
var Annotator,TextPositionAnchor,TextQuoteAnchor,anchorByPosition,findInPages,findPage,getNodeTextLayer,getPage,getPageOffset,getPageTextContent,getSiblingIndex,html,pageTextCache,prioritizePages,quotePositionCache,ref,seek,xpathRange,slice=[].slice;seek=require("dom-seek"),Annotator=require("annotator"),xpathRange=Annotator.Range,html=require("./html"),ref=require("./types"),TextPositionAnchor=ref.TextPositionAnchor,TextQuoteAnchor=ref.TextQuoteAnchor,pageTextCache={},quotePositionCache={},getSiblingIndex=function(e){var t;return t=Array.prototype.slice.call(e.parentNode.childNodes),t.indexOf(e)},getNodeTextLayer=function(e){for(var t;!(null!=(t=e.classList)?t.contains("page"):void 0);)e=e.parentNode;return e.getElementsByClassName("textLayer")[0]},getPage=function(e){return PDFViewerApplication.pdfViewer.getPageView(e)},getPageTextContent=function(e){var t;return null!=pageTextCache[e]?Promise.resolve(pageTextCache[e]):(t=function(t){var n,r,o,a;return r=t.items,o=function(){var e,t,o;for(o=[],e=0,t=r.length;t>e;e++)n=r[e],/\S/.test(n.str)&&o.push(n.str);return o}(),a=o.join(""),pageTextCache[e]=a,a},PDFViewerApplication.pdfViewer.getPageTextContent(e).then(t))},getPageOffset=function(e){var t,n;return t=-1,(n=function(r){return++t===e?Promise.resolve(r):getPageTextContent(t).then(function(e){return n(r+e.length)})})(0)},findPage=function(e){var t,n,r;return n=0,r=0,t=function(o){return r+o.length>e?(e=r,Promise.resolve({index:n,offset:e,textContent:o})):(n++,r+=o.length,getPageTextContent(n).then(t))},getPageTextContent(0).then(t)},anchorByPosition=function(e,t,n){var r,o,a,i,s,c,u,l,g;return u=e.renderingState,c=null!=(i=e.textLayer)?i.renderingDone:void 0,u===RenderingStates.FINISHED&&c?(l=e.textLayer.textLayerDiv,g=t.toSelector(n),html.anchor(l,[g])):(r=null!=(s=e.div)?s:e.el,o=r.getElementsByClassName("annotator-placeholder")[0],null==o&&(o=document.createElement("span"),o.classList.add("annotator-placeholder"),o.textContent="Loading annotationsâ€¦",r.appendChild(o)),a=document.createRange(),a.setStartBefore(o),a.setEndAfter(o),a)},findInPages=function(e,t,n){var r,o,a,i,s,c,u,l;return u=e[0],l=2<=e.length?slice.call(e,1):[],null==u?Promise.reject("quote not found"):(r=function(e){var r,o,a,i,s,c;return s=e[0],o=e[1],i=e[2],c={textContent:o},r=new TextQuoteAnchor.fromSelector(c,t),null!=n?(a=n.start-i,a=Math.max(0,a),a=Math.min(a,o.length),r.toPositionAnchor({hint:a})):r.toPositionAnchor()},i=function(){return findInPages(l,t,n)},o=function(e){var r;return null==quotePositionCache[r=t.exact]&&(quotePositionCache[r]={}),quotePositionCache[t.exact][n.start]={page:c,anchor:e},anchorByPosition(c,e)},c=getPage(u),a=getPageTextContent(u),s=getPageOffset(u),Promise.all([c,a,s]).then(r,i).then(o))},prioritizePages=function(e){var t,n,r,o;return n=PDFViewerApplication.pdfViewer.pagesCount,t=function(){r=[];for(var e=0;n>=0?n>e:e>n;n>=0?e++:e--)r.push(e);return r}.apply(this),o=function(e){var n,r,o;for(n=t.slice(0,e),o=t.slice(e),r=[];n.length||o.length;)o.length&&r.push(o.shift()),n.length&&r.push(n.pop());return r},null!=e?findPage(e.start).then(function(e){var t;return t=e.index,o(t)}):Promise.resolve(t)},exports.anchor=function(e,t,n){var r,o,a,i,s,c,u,l;for(null==n&&(n={}),i=null,c=null,u=null!=t?t:[],o=0,a=u.length;a>o;o++)switch(l=u[o],l.type){case"TextPositionSelector":i=l;break;case"TextQuoteSelector":c=l}return s=Promise.reject("unable to anchor"),r=function(e){if(null!=(null!=c?c.exact:void 0)&&e.toString()!==c.exact)throw new Error("quote mismatch");return e},null!=i&&(s=s["catch"](function(){return findPage(i.start).then(function(t){var o,a,s,c,u,l,g,h;return s=t.index,u=t.offset,h=t.textContent,l=getPage(s),g=i.start-u,a=i.end-u,c=a-g,r(h.substr(g,c)),o=new TextPositionAnchor(e,g,a),anchorByPosition(l,o,n)})})),null!=c&&(s=s["catch"](function(){var e,t,r,o;return null!=i&&null!=(null!=(r=quotePositionCache[c.exact])?r[i.start]:void 0)?(o=quotePositionCache[c.exact][i.start],t=o.page,e=o.anchor,anchorByPosition(t,e,n)):prioritizePages(i).then(function(e){return findInPages(e,c,i)})})),s},exports.describe=function(e,t,n){var r,o,a,i,s,c,u,l,g;if(null==n&&(n={}),t=new xpathRange.BrowserRange(t).normalize(),g=getNodeTextLayer(t.start),i=getNodeTextLayer(t.end),g!==i)throw new Error("selecting across page breaks is not supported");return l=t.limit(g),a=t.limit(i),u=getSiblingIndex(g.parentNode),o=getSiblingIndex(i.parentNode),s=document.createNodeIterator(g,NodeFilter.SHOW_TEXT),c=seek(s,t.start),r=seek(s,t.end)+c+t.end.textContent.length,getPageOffset(u).then(function(t){var o,i,s;return c+=t,r+=t,o=new TextPositionAnchor(e,c,r).toSelector(n),s=document.createRange(),s.setStartBefore(l.start),s.setEndAfter(a.end),i=TextQuoteAnchor.fromRange(e,s,n).toSelector(n),Promise.all([o,i])})},exports.purgeCache=function(){return pageTextCache={},quotePositionCache={}};

},{"./html":4,"./types":6,"annotator":26,"dom-seek":54}],6:[function(require,module,exports){
var Annotator,RangeAnchor,missingParameter,xpathRange;Annotator=require("annotator"),xpathRange=Annotator.Range,missingParameter=function(e){throw new Error('missing required parameter "'+e+'"')},RangeAnchor=function(){function e(e,t){null==e&&missingParameter("root"),null==t&&missingParameter("range"),this.root=e,this.range=xpathRange.sniff(t).normalize(this.root)}return e.fromRange=function(t,n){return new e(t,n)},e.fromSelector=function(t,n){var r,o;return r={start:n.startContainer,startOffset:n.startOffset,end:n.endContainer,endOffset:n.endOffset},o=new xpathRange.SerializedRange(r),new e(t,o)},e.prototype.toRange=function(){return this.range.toRange()},e.prototype.toSelector=function(e){var t;return null==e&&(e={}),t=this.range.serialize(this.root,e.ignoreSelector),{type:"RangeSelector",startContainer:t.start,startOffset:t.startOffset,endContainer:t.end,endOffset:t.endOffset}},e}(),exports.RangeAnchor=RangeAnchor,exports.FragmentAnchor=require("dom-anchor-fragment"),exports.TextPositionAnchor=require("dom-anchor-text-position"),exports.TextQuoteAnchor=require("dom-anchor-text-quote");

},{"annotator":26,"dom-anchor-fragment":50,"dom-anchor-text-position":51,"dom-anchor-text-quote":53}],7:[function(require,module,exports){
"use strict";function config(t){var o={app:t.document.querySelector('link[type="application/annotator+html"]').href};try{Object.assign(o,settings(t.document,"js-hypothesis-config"))}catch(n){console.warn("Could not parse settings from js-hypothesis-config tags",n)}if(t.hasOwnProperty("hypothesisConfig")){if("function"!=typeof t.hypothesisConfig)throw new TypeError("hypothesisConfig must be a function, see: "+docs);Object.assign(o,t.hypothesisConfig())}var e=annotationIDs.extractIDFromURL(t.location.href);return e&&(o.annotations=e),o}var annotationIDs=require("../util/annotation-ids"),settings=require("../settings"),docs="https://h.readthedocs.io/en/latest/hacking/customized-embedding.html";module.exports=config;

},{"../settings":23,"../util/annotation-ids":24}],8:[function(require,module,exports){
var $,Annotator,Guest,adder,animationPromise,baseURI,extend,highlighter,raf,rangeUtil,scrollIntoView,extend1=function(t,n){function e(){this.constructor=t}for(var o in n)hasProp.call(n,o)&&(t[o]=n[o]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},hasProp={}.hasOwnProperty,slice=[].slice,indexOf=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};baseURI=require("document-base-uri"),extend=require("extend"),raf=require("raf"),scrollIntoView=require("scroll-into-view"),Annotator=require("annotator"),$=Annotator.$,adder=require("./adder"),highlighter=require("./highlighter"),rangeUtil=require("./range-util"),animationPromise=function(t){return new Promise(function(n,e){return raf(function(){var o,r;try{return n(t())}catch(r){return o=r,e(o)}})})},module.exports=Guest=function(t){function n(t,e){var o,r,i,a;n.__super__.constructor.apply(this,arguments),this.adderCtrl=new adder.Adder(this.adder[0]),this.anchors=[],o={on:function(t){return function(n,e){return t.subscribe(n,e)}}(this),emit:function(t){return function(){var n,e;return e=arguments[0],n=2<=arguments.length?slice.call(arguments,1):[],t.publish(e,n)}}(this)},this.addPlugin("CrossFrame",o),this.crossframe=this.plugins.CrossFrame,this.crossframe.onConnect(function(t){return function(){return t.publish("panelReady")}}(this)),this._connectAnnotationSync(this.crossframe),this._connectAnnotationUISync(this.crossframe),a=this.options;for(r in a)hasProp.call(a,r)&&(i=a[r],!this.plugins[r]&&Annotator.Plugin[r]&&this.addPlugin(r,i))}var e;return extend1(n,t),e="annotator-highlights-always-on",n.prototype.events={".annotator-adder button click":"onAdderClick",".annotator-adder button mousedown":"onAdderMousedown",".annotator-adder button mouseup":"onAdderMouseup",".annotator-hl click":"onHighlightClick",".annotator-hl mouseover":"onHighlightMouseover",".annotator-hl mouseout":"onHighlightMouseout"},n.prototype.options={Document:{},TextSelection:{}},n.prototype.anchoring=require("./anchoring/html"),n.prototype.anchors=null,n.prototype.visibleHighlights=!1,n.prototype.html=extend({},Annotator.prototype.html,{adder:adder.template()}),n.prototype.getDocumentInfo=function(){var t,n;return null!=this.plugins.PDF?(t=Promise.resolve(this.plugins.PDF.getMetadata()),n=Promise.resolve(this.plugins.PDF.uri())):null!=this.plugins.Document?(n=Promise.resolve(this.plugins.Document.uri()),t=Promise.resolve(this.plugins.Document.metadata)):(n=Promise.reject(),t=Promise.reject()),n=n["catch"](function(){return decodeURIComponent(window.location.href)}),t=t["catch"](function(){return{title:document.title,link:[{href:decodeURIComponent(window.location.href)}]}}),t.then(function(t){return function(t){return n.then(function(n){var e;return e=new URL(n,baseURI),e.hash="",e=e.toString(),{uri:e,metadata:t}})}}(this))},n.prototype._connectAnnotationSync=function(t){return this.subscribe("annotationDeleted",function(t){return function(n){return t.detach(n)}}(this)),this.subscribe("annotationsLoaded",function(t){return function(n){var e,o,r,i;for(i=[],o=0,r=n.length;r>o;o++)e=n[o],i.push(t.anchor(e));return i}}(this))},n.prototype._connectAnnotationUISync=function(t){return t.on("focusAnnotations",function(t){return function(n){var e,o,r,i,a,s,u;for(null==n&&(n=[]),i=t.anchors,s=[],o=0,r=i.length;r>o;o++)e=i[o],null!=e.highlights&&(a=e.annotation.$$tag,u=indexOf.call(n,a)>=0,s.push($(e.highlights).toggleClass("annotator-hl-focused",u)));return s}}(this)),t.on("scrollToAnnotation",function(t){return function(n){var e,o,r,i,a;for(i=t.anchors,a=[],o=0,r=i.length;r>o;o++)e=i[o],null!=e.highlights&&(e.annotation.$$tag===n?a.push(scrollIntoView(e.highlights[0])):a.push(void 0));return a}}(this)),t.on("getDocumentInfo",function(t){return function(n){return t.getDocumentInfo().then(function(t){return n(null,t)})["catch"](function(t){return n(t)})}}(this)),t.on("setVisibleHighlights",function(t){return function(n){return t.setVisibleHighlights(n)}}(this))},n.prototype._setupWrapper=function(){return this.wrapper=this.element,this},n.prototype._setupViewer=function(){return this},n.prototype._setupEditor=function(){return this},n.prototype._setupDocumentEvents=function(){return this},n.prototype._setupDynamicStyle=function(){return this},n.prototype.destroy=function(){var t,n,e;$("#annotator-dynamic-style").remove(),this.adder.remove(),this.element.find(".annotator-hl").each(function(){return $(this).contents().insertBefore(this),$(this).remove()}),this.element.data("annotator",null),e=this.plugins;for(t in e)n=e[t],this.plugins[t].destroy();return this.removeEvents()},n.prototype.anchor=function(t){var n,e,o,r,i,a,s,u,h,l,c,g,p,f,d,m,v;for(d=this,f=this.element[0],o=[],e=[],r=[],null==t.target&&(t.target=[]),l=function(n){var e;return e={cache:d.anchoringCache,ignoreSelector:'[class^="annotator-"]'},d.anchoring.anchor(f,n.selector,e).then(function(e){return{annotation:t,target:n,range:e}})["catch"](function(){return{annotation:t,target:n}})},i=function(t){return null==t.range?t:animationPromise(function(){var n,e,o;return o=Annotator.Range.sniff(t.range),e=o.normalize(f),n=highlighter.highlightRange(e),$(n).data("annotation",t.annotation),t.highlights=n,t})},m=function(n){var e,o,r,i,a,s,u;for(o=!1,r=!1,i=0,a=n.length;a>i;i++)if(e=n[i],null!=e.target.selector&&(o=!0,null!=e.range)){r=!0;break}return t.$orphan=o&&!r,d.anchors=d.anchors.concat(n),null!=(s=d.plugins.BucketBar)&&s.update(),null!=(u=d.plugins.CrossFrame)&&u.sync([t]),n},c=d.anchors.splice(0,d.anchors.length),a=0,u=c.length;u>a;a++)n=c[a],n.annotation===t?null!=n.range&&(g=n.target,indexOf.call(t.target,g)>=0)?(o.push(n),e.push(n.target)):null!=n.highlights&&(r=r.concat(n.highlights),delete n.highlights,delete n.range):d.anchors.push(n);for(raf(function(){return highlighter.removeHighlights(r)}),p=t.target,s=0,h=p.length;h>s;s++)v=p[s],indexOf.call(e,v)<0&&(n=l(v).then(i),o.push(n));return Promise.all(o).then(m)},n.prototype.detach=function(t){var n,e,o,r,i,a,s,u,h;for(e=[],u=[],h=[],i=this.anchors,o=0,r=i.length;r>o;o++)n=i[o],n.annotation===t?h.push(null!=(a=n.highlights)?a:[]):e.push(n);return this.anchors=e,h=(s=Array.prototype).concat.apply(s,h),raf(function(t){return function(){var n;return highlighter.removeHighlights(h),null!=(n=t.plugins.BucketBar)?n.update():void 0}}(this))},n.prototype.createAnnotation=function(t){var n,e,o,r,i,a,s,u,h,l,c;return null==t&&(t={}),u=this,a=this.element[0],r=null!=(i=this.selectedRanges)?i:[],this.selectedRanges=null,n=function(t){var n;return n={cache:u.anchoringCache,ignoreSelector:'[class^="annotator-"]'},u.anchoring.describe(a,t,n)},h=function(n){return t.document=n.metadata,t.uri=n.uri},l=function(n){var e,o,r,i;return e=n[0],r=n[1],i=e.uri,t.target=function(){var t,n,e;for(e=[],t=0,n=r.length;n>t;t++)o=r[t],e.push({source:i,selector:o});return e}()},e=this.getDocumentInfo(),s=Promise.all(r.map(n)),o=e.then(h),c=Promise.all([e,s]).then(l),c.then(function(){return u.publish("beforeAnnotationCreated",[t])}),c.then(function(){return u.anchor(t)}),t},n.prototype.createHighlight=function(){return this.createAnnotation({$highlight:!0})},n.prototype.createComment=function(){var t,n,e;return t={},e=this,n=function(n){return t.document=n.metadata,t.uri=n.uri,t.target=[{source:n.uri}]},this.getDocumentInfo().then(n).then(function(){return e.publish("beforeAnnotationCreated",[t])}),t},n.prototype.showAnnotations=function(t){var n,e,o;return o=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],r.push(n.$$tag);return r}(),null!=(e=this.crossframe)?e.call("showAnnotations",o):void 0},n.prototype.toggleAnnotationSelection=function(t){var n,e,o;return o=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],r.push(n.$$tag);return r}(),null!=(e=this.crossframe)?e.call("toggleAnnotationSelection",o):void 0},n.prototype.updateAnnotations=function(t){var n,e,o;return o=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],r.push(n.$$tag);return r}(),null!=(e=this.crossframe)?e.call("updateAnnotations",o):void 0},n.prototype.focusAnnotations=function(t){var n,e,o;return o=function(){var e,o,r;for(r=[],e=0,o=t.length;o>e;e++)n=t[e],r.push(n.$$tag);return r}(),null!=(e=this.crossframe)?e.call("focusAnnotations",o):void 0},n.prototype.onSuccessfulSelection=function(t,n){var e,o,r,i,a,s,u;if(null==t)throw"Called onSuccessfulSelection without an event!";if(null==t.ranges)throw"Called onSuccessulSelection with an event with missing ranges!";return this.selectedRanges=t.ranges,Annotator.$(".annotator-toolbar .h-icon-note").attr("title","New Annotation").removeClass("h-icon-note").addClass("h-icon-annotate"),n?this.onAdderClick(t):(s=Annotator.Util.getGlobal().getSelection(),r=rangeUtil.isSelectionBackwards(s),o=rangeUtil.selectionFocusRect(s),a=this.adderCtrl.target(o,r),i=a.left,u=a.top,e=a.arrowDirection,this.adderCtrl.showAt(i,u,e)),!0},n.prototype.onFailedSelection=function(t){return this.adderCtrl.hide(),this.selectedRanges=[],Annotator.$(".annotator-toolbar .h-icon-annotate").attr("title","New Page Note").removeClass("h-icon-annotate").addClass("h-icon-note")},n.prototype.selectAnnotations=function(t,n){return n?this.toggleAnnotationSelection(t):this.showAnnotations(t)},n.prototype.onHighlightMouseover=function(t){var n,e;if(this.visibleHighlights)return n=$(t.currentTarget).data("annotation"),e=null!=t.annotations?t.annotations:t.annotations=[],e.push(n),t.target===t.currentTarget?setTimeout(function(t){return function(){return t.focusAnnotations(e)}}(this)):void 0},n.prototype.onHighlightMouseout=function(t){return this.visibleHighlights?this.focusAnnotations([]):void 0},n.prototype.onHighlightClick=function(t){var n,e,o;if(this.visibleHighlights)return n=$(t.currentTarget).data("annotation"),e=null!=t.annotations?t.annotations:t.annotations=[],e.push(n),t.target===t.currentTarget?(o=t.metaKey||t.ctrlKey,setTimeout(function(t){return function(){return t.selectAnnotations(e,o)}}(this))):void 0},n.prototype.setVisibleHighlights=function(t){var n;return null!=(n=this.crossframe)&&n.call("setVisibleHighlights",t),this.toggleHighlightClass(t),this.publish("setVisibleHighlights",t)},n.prototype.toggleHighlightClass=function(t){return t?this.element.addClass(e):this.element.removeClass(e),this.visibleHighlights=t},n.prototype.onAdderMouseup=function(t){return t.preventDefault(),t.stopPropagation()},n.prototype.onAdderMousedown=function(){},n.prototype.onAdderClick=function(t){switch("function"==typeof t.preventDefault&&t.preventDefault(),"function"==typeof t.stopPropagation&&t.stopPropagation(),this.adderCtrl.hide(),$(t.target).data("action")){case"highlight":this.setVisibleHighlights(!0),this.createHighlight();break;case"comment":this.createAnnotation()}return Annotator.Util.getGlobal().getSelection().removeAllRanges()},n}(Annotator);

},{"./adder":3,"./anchoring/html":4,"./highlighter":9,"./range-util":18,"annotator":26,"document-base-uri":49,"extend":55,"raf":59,"scroll-into-view":61}],9:[function(require,module,exports){
var $,Annotator;Annotator=require("annotator"),$=Annotator.$,exports.highlightRange=function(t,n){var r,e,o;return null==n&&(n="annotator-hl"),o=/^\s*$/,r=$("<span class='"+n+"'></span>"),e=$(t.textNodes()).filter(function(t){return!o.test(this.nodeValue)}),e.wrap(r).parent().toArray()},exports.removeHighlights=function(t){var n,r,e,o;for(o=[],r=0,e=t.length;e>r;r++)n=t[r],null!=n.parentNode&&o.push($(n).replaceWith(n.childNodes));return o},exports.getBoundingClientRect=function(t){var n;return n=t.map(function(t){return t.getBoundingClientRect()}),n.reduce(function(t,n){return{top:Math.min(t.top,n.top),left:Math.min(t.left,n.left),bottom:Math.max(t.bottom,n.bottom),right:Math.max(t.right,n.right)}})};

},{"annotator":26}],10:[function(require,module,exports){
var $,Annotator,Guest,Host,queryString,extend=function(t,r){function e(){this.constructor=t}for(var n in r)hasProp.call(r,n)&&(t[n]=r[n]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var r=0,e=this.length;e>r;r++)if(r in this&&this[r]===t)return r;return-1};Annotator=require("annotator"),queryString=require("query-string"),$=Annotator.$,Guest=require("./guest"),module.exports=Host=function(t){function r(t,e){var n,o;o=queryString.stringify(Object.assign({},e,{app:void 0})),e.app+=(indexOf.call(e.app,"?")>=0?"&":"?")+o,n=$("<iframe></iframe>").attr("name","hyp_sidebar_frame").attr("allowfullscreen","").attr("seamless","").attr("src",e.app).addClass("h-sidebar-iframe"),this.frame=$("<div></div>").css("display","none").addClass("annotator-frame annotator-outer").appendTo(t),r.__super__.constructor.apply(this,arguments),n.appendTo(this.frame),this.on("panelReady",function(t){return function(){return void 0===e.showHighlights&&(e.showHighlights=!0),t.setVisibleHighlights(e.showHighlights),t.frame.css("display","")}}(this)),this.on("beforeAnnotationCreated",function(t){return t.$highlight?void 0:n[0].contentWindow.focus()})}return extend(r,t),r.prototype.destroy=function(){return this.frame.remove(),r.__super__.destroy.apply(this,arguments)},r}(Guest);

},{"./guest":8,"annotator":26,"query-string":57}],11:[function(require,module,exports){
"use strict";require("../polyfills");var Annotator=require("annotator"),g=Annotator.Util.getGlobal();g.wgxpath&&g.wgxpath.install(),Annotator.Guest=require("./guest"),Annotator.Host=require("./host"),Annotator.Sidebar=require("./sidebar"),Annotator.PdfSidebar=require("./pdf-sidebar"),Annotator.Plugin.BucketBar=require("./plugin/bucket-bar"),Annotator.Plugin.Toolbar=require("./plugin/toolbar"),Annotator.Plugin.PDF=require("./plugin/pdf"),require("../vendor/annotator.document"),Annotator.Plugin.TextSelection=require("./plugin/textselection"),Annotator.Plugin.CrossFrame=require("./plugin/cross-frame"),Annotator.Plugin.CrossFrame.AnnotationSync=require("../annotation-sync"),Annotator.Plugin.CrossFrame.Bridge=require("../bridge"),Annotator.Plugin.CrossFrame.Discovery=require("../discovery");var appLinkEl=document.querySelector('link[type="application/annotator+html"]'),options=require("./config")(window);Annotator.noConflict().$.noConflict(!0)(function(){var n=window.PDFViewerApplication?Annotator.PdfSidebar:Annotator.Sidebar;options.hasOwnProperty("constructor")&&(n=options.constructor,delete options.constructor),window.annotator=new n(document.body,options),appLinkEl.addEventListener("destroy",function(){appLinkEl.parentElement.removeChild(appLinkEl),window.annotator.destroy(),window.annotator=void 0})});

},{"../annotation-sync":1,"../bridge":20,"../discovery":21,"../polyfills":"/h/static/scripts/polyfills.js","../vendor/annotator.document":25,"./config":7,"./guest":8,"./host":10,"./pdf-sidebar":12,"./plugin/bucket-bar":13,"./plugin/cross-frame":14,"./plugin/pdf":15,"./plugin/textselection":16,"./plugin/toolbar":17,"./sidebar":19,"annotator":26}],12:[function(require,module,exports){
var PdfSidebar,Sidebar,extend=function(r,e){function t(){this.constructor=r}for(var o in e)hasProp.call(e,o)&&(r[o]=e[o]);return t.prototype=e.prototype,r.prototype=new t,r.__super__=e.prototype,r},hasProp={}.hasOwnProperty;Sidebar=require("./sidebar"),module.exports=PdfSidebar=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,r),e.prototype.options={TextSelection:{},PDF:{},BucketBar:{container:".annotator-frame",scrollables:["#viewerContainer"]},Toolbar:{container:".annotator-frame"}},e}(Sidebar);

},{"./sidebar":19}],13:[function(require,module,exports){
var $,Annotator,BUCKET_NAV_SIZE,BUCKET_SIZE,BUCKET_TOP_THRESHOLD,BucketBar,highlighter,raf,scrollIntoView,scrollToClosest,bind=function(t,n){return function(){return t.apply(n,arguments)}},extend=function(t,n){function e(){this.constructor=t}for(var o in n)hasProp.call(n,o)&&(t[o]=n[o]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};raf=require("raf"),Annotator=require("annotator"),$=Annotator.$,scrollIntoView=require("scroll-into-view"),highlighter=require("../highlighter"),BUCKET_SIZE=16,BUCKET_NAV_SIZE=BUCKET_SIZE+6,BUCKET_TOP_THRESHOLD=115+BUCKET_NAV_SIZE,scrollToClosest=function(t,n){var e,o;return e="up"===n?1:-1,o=t.reduce(function(t,n){var r,i,s;return(null!=(i=n.highlights)?i.length:void 0)?(s=t.start,o=t.next,r=highlighter.getBoundingClientRect(n.highlights),1===e&&r.top>=BUCKET_TOP_THRESHOLD?t:-1===e&&r.top<=window.innerHeight-BUCKET_NAV_SIZE?t:null==o?{start:r.top,next:n}:s*e<r.top*e?{start:r.top,next:n}:t):t},{}).next,scrollIntoView(o.highlights[0])},module.exports=BucketBar=function(t){function n(t,e){this.update=bind(this.update,this),n.__super__.constructor.call(this,$(this.html),e),null!=this.options.container?$(this.options.container).append(this.element):$(t).append(this.element)}return extend(n,t),n.prototype.html='<div class="annotator-bucket-bar">\n</div>',n.prototype.options={gapSize:60,scrollables:["body"]},n.prototype.buckets=[],n.prototype.index=[],n.prototype.tabs=null,n.prototype.pluginInit=function(){var t,n,e,o,r,i;for($(window).on("resize scroll",this.update),o=null!=(e=this.options.scrollables)?e:[],r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push($(i).on("resize scroll",this.update));return r},n.prototype.destroy=function(){var t,n,e,o,r,i;for($(window).off("resize scroll",this.update),o=null!=(e=this.options.scrollables)?e:[],r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push($(i).off("resize scroll",this.update));return r},n.prototype._collate=function(t,n){var e,o,r;for(e=o=0,r=t.length-1;r>=0?r>=o:o>=r;e=r>=0?++o:--o){if(t[e]<n[e])return-1;if(t[e]>n[e])return 1}return 0},n.prototype.update=function(){return null==this._updatePending?this._updatePending=raf(function(t){return function(){return delete t._updatePending,t._update()}}(this)):void 0},n.prototype._update=function(){var t,n,e,o,r,i,s,u,h,l;for(t=[],e=[],u=this.annotator.anchors.reduce(function(n){return function(n,o,r){var i,s,u,h;return(null!=(u=o.highlights)?u.length:void 0)?(s=highlighter.getBoundingClientRect(o.highlights),h=s.top,i=s.bottom-s.top,BUCKET_TOP_THRESHOLD>h?indexOf.call(t,o)<0&&t.push(o):h>window.innerHeight-BUCKET_NAV_SIZE?indexOf.call(e,o)<0&&e.push(o):(n.push([h,1,o]),n.push([h+i,-1,o])),n):n}}(this),[]),h=u.sort(this._collate).reduce(function(t){return function(n,e,o,r){var i,s,u,h,l,a,c,p,d,g,f,_,T,E,b,B;if(u=n.buckets,a=n.index,h=n.carry,B=e[0],l=e[1],i=e[2],l>0?(c=h.anchors.indexOf(i))<0?(h.anchors.unshift(i),h.counts.unshift(1)):h.counts[c]++:(c=h.anchors.indexOf(i),0===--h.counts[c]&&(h.anchors.splice(c,1),h.counts.splice(c,1))),0===a.length||o===r.length-1||0===h.anchors.length||B-a[a.length-1]>t.options.gapSize)u.push(h.anchors.slice()),a.push(B);else{for((null!=(T=u[u.length-2])?T.length:void 0)?(g=u[u.length-2],b=u.pop(),a.pop()):(g=u[u.length-1],b=[]),E=h.anchors,p=0,f=E.length;f>p;p++)s=E[p],indexOf.call(g,s)<0&&g.push(s);for(d=0,_=b.length;_>d;d++)s=b[d],indexOf.call(g,s)<0&&g.push(s)}return{buckets:u,index:a,carry:h}}}(this),{buckets:[],index:[],carry:{anchors:[],counts:[],latest:0}}),this.buckets=h.buckets,this.index=h.index,this.buckets.unshift([],t,[]),this.index.unshift(0,BUCKET_TOP_THRESHOLD-1,BUCKET_TOP_THRESHOLD),this.buckets.push([],e,[]),this.index.push(window.innerHeight-BUCKET_NAV_SIZE,window.innerHeight-BUCKET_NAV_SIZE+1,window.innerHeight),s=0,l=this.buckets,r=0,i=l.length;i>r;r++)n=l[r],s=Math.max(s,n.length);return o=this.element,this.tabs||(this.tabs=$([])),this.tabs.slice(this.buckets.length).remove(),this.tabs=this.tabs.slice(0,this.buckets.length),$.each(this.buckets.slice(this.tabs.length),function(t){return function(){var n;return n=$("<div/>").appendTo(o),t.tabs.push(n[0]),n.addClass("annotator-bucket-indicator").on("mousemove",function(n){var e,o,r,i,s,u,h;for(o=t.tabs.index(n.currentTarget),s=t.annotator.anchors,u=[],r=0,i=s.length;i>r;r++)e=s[r],h=indexOf.call(t.buckets[o],e)>=0,u.push($(e.highlights).toggleClass("annotator-hl-focused",h));return u}).on("mouseout",function(n){var e,o,r,i,s,u;for(o=t.tabs.index(n.currentTarget),s=t.buckets[o],u=[],r=0,i=s.length;i>r;r++)e=s[r],u.push($(e.highlights).removeClass("annotator-hl-focused"));return u}).on("click",function(n){var e,o,r;return r=t.tabs.index(n.currentTarget),n.stopPropagation(),t.isUpper(r)?scrollToClosest(t.buckets[r],"up"):t.isLower(r)?scrollToClosest(t.buckets[r],"down"):(o=function(){var t,n,o,i;for(o=this.buckets[r],i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(e.annotation);return i}.call(t),annotator.selectAnnotations(o,n.ctrlKey||n.metaKey))})}}(this)),this._buildTabs(this.tabs,this.buckets)},n.prototype._buildTabs=function(){return this.tabs.each(function(t){return function(n,e){var o,r,i,s;return e=$(e),o=t.buckets[n],r=null!=o?o.length:void 0,s=1!==r?"Show "+r+" annotations":r>0?"Show one annotation":void 0,e.attr("title",s),e.toggleClass("upper",t.isUpper(n)),e.toggleClass("lower",t.isLower(n)),i=t.isUpper(n)||t.isLower(n)?BUCKET_NAV_SIZE:BUCKET_SIZE,e.css({top:(t.index[n]+t.index[n+1])/2,marginTop:-i/2,display:r?"":"none"}),o?e.html("<div class='label'>"+r+"</div>"):void 0}}(this))},n.prototype.isUpper=function(t){return 1===t},n.prototype.isLower=function(t){return t===this.index.length-2},n}(Annotator.Plugin),BucketBar.BUCKET_SIZE=BUCKET_SIZE,BucketBar.BUCKET_NAV_SIZE=BUCKET_NAV_SIZE,BucketBar.BUCKET_TOP_THRESHOLD=BUCKET_TOP_THRESHOLD;

},{"../highlighter":9,"annotator":26,"raf":59,"scroll-into-view":61}],14:[function(require,module,exports){
var Annotator,CrossFrame,extract,slice=[].slice,extend=function(t,n){function r(){this.constructor=t}for(var o in n)hasProp.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},hasProp={}.hasOwnProperty;Annotator=require("annotator"),extract=extract=function(){var t,n,r,o,e,c;for(e=arguments[0],r=2<=arguments.length?slice.call(arguments,1):[],c={},t=0,o=r.length;o>t;t++)n=r[t],e.hasOwnProperty(n)&&(c[n]=e[n]);return c},module.exports=CrossFrame=function(t){function n(t,r){var o,e,c,a;n.__super__.constructor.apply(this,arguments),a=extract(r,"server"),c=new n.Discovery(window,a),e=new n.Bridge,a=extract(r,"on","emit","formatter","parser"),o=new n.AnnotationSync(e,a),this.pluginInit=function(){var t;return t=function(t,n,r){return e.createChannel(t,n,r)},c.startDiscovery(t)},this.destroy=function(){return Annotator.Plugin.prototype.destroy.apply(this,arguments),c.stopDiscovery()},this.sync=function(t,n){return o.sync(t,n)},this.on=function(t,n){return e.on(t,n)},this.call=function(){var t,n;return n=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],e.call.apply(e,[n].concat(slice.call(t)))},this.onConnect=function(t){return e.onConnect(t)}}return extend(n,t),n}(Annotator.Plugin);

},{"annotator":26}],15:[function(require,module,exports){
var Annotator,PDF,extend,extend1=function(e,t){function n(){this.constructor=e}for(var r in t)hasProp.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};extend=require("extend"),Annotator=require("annotator"),module.exports=PDF=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend1(t,e),t.prototype.documentLoaded=null,t.prototype.observer=null,t.prototype.pdfViewer=null,t.prototype.pluginInit=function(){return this.annotator.anchoring=require("../anchoring/pdf"),this.pdfViewer=PDFViewerApplication.pdfViewer,this.pdfViewer.viewer.classList.add("has-transparent-text-layer"),PDFViewerApplication.loading?this.documentLoaded=new Promise(function(e){var t;return t=function(n){return window.removeEventListener("documentload",t),e()},window.addEventListener("documentload",t)}):this.documentLoaded=Promise.resolve(),this.observer=new MutationObserver(function(e){return function(t){return e._update()}}(this)),this.observer.observe(this.pdfViewer.viewer,{attributes:!0,attributeFilter:["data-loaded"],childList:!0,subtree:!0})},t.prototype.destroy=function(){return this.pdfViewer.viewer.classList.remove("has-transparent-text-layer"),this.observer.disconnect()},t.prototype.uri=function(){return this.documentLoaded.then(function(){return PDFViewerApplication.url})},t.prototype.getMetadata=function(){return this.documentLoaded.then(function(){var e,t,n,r,i,o;return t=PDFViewerApplication.documentInfo,r=PDFViewerApplication.metadata,i=(null!=r?r.has("dc:title"):void 0)&&"Untitled"!==r.get("dc:title")?r.get("dc:title"):(null!=t?t.Title:void 0)?t.Title:document.title,o="urn:x-pdf:"+PDFViewerApplication.documentFingerprint,n=[{href:o},{href:PDFViewerApplication.url}],e=PDFViewerApplication.documentFingerprint,{title:i,link:n,documentFingerprint:e}})},t.prototype._update=function(){var e,t,n,r,i,o,a,d,u,l,s,p,c,h,f,g,w,v,m,y,P,V,F,x;for(n=this.annotator,f=this.pdfViewer,F=[],h=o=0,w=f.pagesCount;w>=0?w>o:o>w;h=w>=0?++o:--o)if(c=f.getPageView(h),null!=(v=c.textLayer)?v.renderingDone:void 0)switch(r=null!=(m=c.div)?m:c.el,g=r.getElementsByClassName("annotator-placeholder")[0],c.renderingState){case RenderingStates.INITIAL:c.textLayer=null;break;case RenderingStates.FINISHED:null!=g&&g.parentNode.removeChild(g)}for(y=n.anchors,a=0,l=y.length;l>a;a++)if(e=y[a],null!=e.highlights&&(P=e.annotation,!(indexOf.call(F,P)>=0)))for(V=e.highlights,d=0,s=V.length;s>d;d++)if(i=V[d],!document.body.contains(i)){delete e.highlights,delete e.range,F.push(e.annotation);break}for(x=[],u=0,p=F.length;p>u;u++)t=F[u],x.push(n.anchor(t));return x},t}(Annotator.Plugin);

},{"../anchoring/pdf":5,"annotator":26,"extend":55}],16:[function(require,module,exports){
var $,Annotator,TextSelection,bind=function(t,n){return function(){return t.apply(n,arguments)}},extend=function(t,n){function e(){this.constructor=t}for(var o in n)hasProp.call(n,o)&&(t[o]=n[o]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},hasProp={}.hasOwnProperty;Annotator=require("annotator"),$=Annotator.$,module.exports=TextSelection=function(t){function n(){return this.checkForEndSelection=bind(this.checkForEndSelection,this),n.__super__.constructor.apply(this,arguments)}return extend(n,t),n.prototype.pluginInit=function(){return $(document).bind({touchend:this.checkForEndSelection,mouseup:this.checkForEndSelection,ready:this.checkForEndSelection}),null},n.prototype.destroy=function(){return $(document).unbind({touchend:this.checkForEndSelection,mouseup:this.checkForEndSelection,ready:this.checkForEndSelection}),n.__super__.destroy.apply(this,arguments)},n.prototype.checkForEndSelection=function(t){var n;return null==t&&(t={}),n=function(){var n,e,o,r;return r=Annotator.Util.getGlobal().getSelection(),o=function(){var t,o,c;for(c=[],n=t=0,o=r.rangeCount;o>=0?o>t:t>o;n=o>=0?++t:--t)e=r.getRangeAt(0),e.collapsed||c.push(e);return c}(),o.length?(t.ranges=o,this.annotator.onSuccessfulSelection(t)):this.annotator.onFailedSelection(t)},setTimeout(n,0)},n}(Annotator.Plugin);

},{"annotator":26}],17:[function(require,module,exports){
var $,Annotator,Toolbar,makeButton,extend=function(t,o){function n(){this.constructor=t}for(var i in o)hasProp.call(o,i)&&(t[i]=o[i]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t},hasProp={}.hasOwnProperty;Annotator=require("annotator"),$=Annotator.$,makeButton=function(t){var o,n;return o=$("<button></button>").attr("href","").attr("title",t.title).attr("name",t.name).on(t.on).addClass("annotator-frame-button").addClass(t["class"]),n=$("<li></li>").append(o),n[0]},module.exports=Toolbar=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}var n;return extend(o,t),n="annotator-hide",o.prototype.events={setVisibleHighlights:"onSetVisibleHighlights"},o.prototype.html='<div class="annotator-toolbar"></div>',o.prototype.pluginInit=function(){var t,o,n;return this.annotator.toolbar=this.toolbar=$(this.html),null!=this.options.container?$(this.options.container).append(this.toolbar):$(this.element).append(this.toolbar),o=[{title:"Toggle or Resize Sidebar","class":"annotator-frame-button--sidebar_toggle h-icon-chevron-left",name:"sidebar-toggle",on:{click:function(t){return function(o){var n;return o.preventDefault(),o.stopPropagation(),n=t.annotator.frame.hasClass("annotator-collapsed"),n?t.annotator.show():t.annotator.hide()}}(this)}},{title:"Hide Highlights","class":"h-icon-visibility",name:"highlight-visibility",on:{click:function(t){return function(o){var n;return o.preventDefault(),o.stopPropagation(),n=!t.annotator.visibleHighlights,t.annotator.setVisibleHighlights(n)}}(this)}},{title:"New Page Note","class":"h-icon-note",name:"insert-comment",on:{click:function(t){return function(o){return o.preventDefault(),o.stopPropagation(),t.annotator.createAnnotation(),t.annotator.show()}}(this)}}],this.buttons=$(function(){var n,i,e;for(e=[],n=0,i=o.length;i>n;n++)t=o[n],e.push(makeButton(t));return e}()),n=$("<ul></ul>"),this.buttons.appendTo(n),this.toolbar.append(n),this.toolbar.on("mouseup","a",function(t){return $(t.target).blur()})},o.prototype.onSetVisibleHighlights=function(t){return t?$("[name=highlight-visibility]").removeClass("h-icon-visibility-off").addClass("h-icon-visibility").prop("title","Hide Highlights"):$("[name=highlight-visibility]").removeClass("h-icon-visibility").addClass("h-icon-visibility-off").prop("title","Show Highlights")},o}(Annotator.Plugin);

},{"annotator":26}],18:[function(require,module,exports){
"use strict";function translate(e,t,n){return{left:e.left+t,top:e.top+n,width:e.width,height:e.height}}function mapViewportRectToDocument(e,t){return translate(t,e.pageXOffset,e.pageYOffset)}function isSelectionBackwards(e){if(e.focusNode===e.anchorNode)return e.focusOffset<e.anchorOffset;var t=e.getRangeAt(0);return t.startContainer===e.focusNode}function isNodeInRange(e,t){if(t===e.startContainer||t===e.endContainer)return!0;var n=e.startContainer.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING,o=e.endContainer.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_PRECEDING;return n&&o}function forEachNodeInRange(e,t){for(var n,o=e.commonAncestorContainer,r=o.ownerDocument.createNodeIterator(o,NodeFilter.SHOW_ALL,null,!1);n=r.nextNode();)isNodeInRange(e,n)&&t(n)}function getTextBoundingBoxes(e){var t=/^\s*$/,n=[];forEachNodeInRange(e,function(e){e.nodeType!==Node.TEXT_NODE||e.textContent.match(t)||n.push(e)});var o=[];return n.forEach(function(t){var n=t.ownerDocument.createRange();if(n.selectNodeContents(t),t===e.startContainer&&n.setStart(t,e.startOffset),t===e.endContainer&&n.setEnd(t,e.endOffset),!n.collapsed){var r=Array.from(n.getClientRects());n.detach(),o=o.concat(r.map(function(e){return mapViewportRectToDocument(t.ownerDocument.defaultView,e)}))}}),o}function selectionFocusRect(e){if(e.isCollapsed)return null;var t=getTextBoundingBoxes(e.getRangeAt(0));return 0===t.length?null:isSelectionBackwards(e)?t[0]:t[t.length-1]}module.exports={isSelectionBackwards:isSelectionBackwards,selectionFocusRect:selectionFocusRect};

},{}],19:[function(require,module,exports){
var Hammer,Host,MIN_RESIZE,Sidebar,extend,raf,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend1=function(t,e){function n(){this.constructor=t}for(var i in e)hasProp.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;extend=require("extend"),raf=require("raf"),Hammer=require("hammerjs"),Host=require("./host"),MIN_RESIZE=280,module.exports=Sidebar=function(t){function e(t,n){this.onSwipe=bind(this.onSwipe,this),this.onPan=bind(this.onPan,this),e.__super__.constructor.apply(this,arguments),this.hide(),(n.firstRun||n.annotations)&&this.on("panelReady",function(t){return function(){return t.show()}}(this)),null!=this.plugins.BucketBar&&this.plugins.BucketBar.element.on("click",function(t){return function(e){return t.show()}}(this)),null!=this.plugins.Toolbar&&this._setupGestures(),this._setupSidebarEvents()}return extend1(e,t),e.prototype.options={Document:{},TextSelection:{},BucketBar:{container:".annotator-frame"},Toolbar:{container:".annotator-frame"}},e.prototype.renderFrame=null,e.prototype.gestureState=null,e.prototype._setupDocumentEvents=function(){return this.element.on("click",function(t){return function(e){var n;return(null!=(n=t.selectedTargets)?n.length:void 0)?void 0:t.hide()}}(this)),this},e.prototype._setupSidebarEvents=function(){return this.crossframe.on("show",this.show.bind(this)),this.crossframe.on("hide",this.hide.bind(this)),this},e.prototype._setupGestures=function(){var t,e,n,i;return t=this.toolbar.find("[name=sidebar-toggle]"),t.on("touchmove",function(t){return t.preventDefault()}),e=new Hammer.Manager(t[0]).on("panstart panend panleft panright",this.onPan).on("swipeleft swiperight",this.onSwipe),n=e.add(new Hammer.Pan({direction:Hammer.DIRECTION_HORIZONTAL})),i=e.add(new Hammer.Swipe({direction:Hammer.DIRECTION_HORIZONTAL})),i.recognizeWith(n),this._initializeGestureState(),this},e.prototype._initializeGestureState=function(){return this.gestureState={initial:null,"final":null}},e.prototype._updateLayout=function(){return this.renderFrame?void 0:this.renderFrame=raf(function(t){return function(){var e,n;return t.renderFrame=null,t.gestureState["final"]!==t.gestureState.initial&&(e=t.gestureState["final"],n=-e,t.frame.css("margin-left",e+"px"),n>=MIN_RESIZE)?t.frame.css("width",n+"px"):void 0}}(this))},e.prototype.onPan=function(t){var e,n;switch(t.type){case"panstart":return this._initializeGestureState(),this.frame.addClass("annotator-no-transition"),this.frame.css("pointer-events","none"),this.gestureState.initial=parseInt(getComputedStyle(this.frame[0]).marginLeft);case"panend":return this.frame.removeClass("annotator-no-transition"),this.frame.css("pointer-events",""),this.gestureState["final"]<=-MIN_RESIZE?this.show():this.hide(),this._initializeGestureState();case"panleft":case"panright":if(null==this.gestureState.initial)return;return n=this.gestureState.initial,e=t.deltaX,this.gestureState["final"]=Math.min(Math.round(n+e),0),this._updateLayout()}},e.prototype.onSwipe=function(t){switch(t.type){case"swipeleft":return this.show();case"swiperight":return this.hide()}},e.prototype.show=function(){return this.frame.css({"margin-left":-1*this.frame.width()+"px"}),this.frame.removeClass("annotator-collapsed"),null!=this.toolbar?this.toolbar.find("[name=sidebar-toggle]").removeClass("h-icon-chevron-left").addClass("h-icon-chevron-right"):void 0},e.prototype.hide=function(){return this.frame.css({"margin-left":""}),this.frame.addClass("annotator-collapsed"),null!=this.toolbar?this.toolbar.find("[name=sidebar-toggle]").removeClass("h-icon-chevron-right").addClass("h-icon-chevron-left"):void 0},e.prototype.createAnnotation=function(t){return null==t&&(t={}),e.__super__.createAnnotation.apply(this,arguments),t.$highlight?void 0:this.show()},e.prototype.showAnnotations=function(t){return e.__super__.showAnnotations.apply(this,arguments),this.show()},e}(Host);

},{"./host":10,"extend":55,"hammerjs":56,"raf":59}],20:[function(require,module,exports){
var Bridge,RPC,extend,slice=[].slice;extend=require("extend"),RPC=require("./frame-rpc"),module.exports=Bridge=function(){function n(){this.links=[],this.channelListeners={},this.onConnectListeners=[]}return n.prototype.links=null,n.prototype.channelListeners=null,n.prototype.onConnectListeners=null,n.prototype.createChannel=function(n,t,e){var r,i,o,l,c;return r=null,o=!1,c=function(t){return function(){var e,i,l,c,u;if(!o){for(o=!0,c=t.onConnectListeners,u=[],i=0,l=c.length;l>i;i++)e=c[i],u.push(e.call(null,r,n));return u}}}(this),i=function(n){return function(n,t){return n===e?(t(),c()):void 0}}(this),l=extend({connect:i},this.channelListeners),r=new RPC(window,n,t,l),r.call("connect",e,c),this.links.push({channel:r,window:n}),r},n.prototype.call=function(){var n,t,e,r,i,o;return r=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],e=null,"function"==typeof t[t.length-1]&&(e=t[t.length-1],t=t.slice(0,-1)),n=function(n){return function(t){return function(e){var r;throw t.destroy(),n.links=function(){var n,e,i,o;for(i=this.links,o=[],n=0,e=i.length;e>n;n++)r=i[n],r.channel!==t&&o.push(r);return o}.call(n),e}}}(this),i=this.links.map(function(e){var i;return i=new Promise(function(n,i){var o,l,c,u;u=setTimeout(function(){return n(null)},1e3);try{return(c=e.channel).call.apply(c,[r].concat(slice.call(t),[function(t,e){return clearTimeout(u),t?i(t):n(e)}]))}catch(l){return o=l,i(o)}}),i["catch"](n(e.channel))}),o=Promise.all(i),null!=e&&(o=o.then(function(n){return e(null,n)})["catch"](function(n){return e(n)})),o},n.prototype.on=function(n,t){if(this.channelListeners[n])throw new Error("Listener '"+n+"' already bound in Bridge");return this.channelListeners[n]=t,this},n.prototype.off=function(n){return delete this.channelListeners[n],this},n.prototype.onConnect=function(n){return this.onConnectListeners.push(n),this},n}();

},{"./frame-rpc":22,"extend":55}],21:[function(require,module,exports){
var Discovery,bind=function(e,s){return function(){return e.apply(s,arguments)}};module.exports=Discovery=function(){function e(e,s){this.target=e,null==s&&(s={}),this._onMessage=bind(this._onMessage,this),this.stopDiscovery=bind(this.stopDiscovery,this),s.server&&(this.server=s.server),s.origin&&(this.origin=s.origin)}return e.prototype.server=!1,e.prototype.origin="*",e.prototype.onDiscovery=null,e.prototype.requestInProgress=!1,e.prototype.startDiscovery=function(e){if(this.onDiscovery)throw new Error("Discovery is already in progress, call .stopDiscovery() first");this.onDiscovery=e,this.target.addEventListener("message",this._onMessage,!1),this._beacon()},e.prototype.stopDiscovery=function(){this.onDiscovery=null,this.target.removeEventListener("message",this._onMessage)},e.prototype._beacon=function(){var e,s,r,o,t,i,n;for(e=this.server?"__cross_frame_dhcp_offer":"__cross_frame_dhcp_discovery",i=[this.target.top];i.length;)for(t=i.shift(),t!==this.target&&t.postMessage(e,this.origin),n=t.frames,r=0,o=n.length;o>r;r++)s=n[r],i.push(s)},e.prototype._onMessage=function(e){var s,r,o,t,i,n,c,a,p;a=e.source,i=e.origin,s=e.data,("null"===i||i.match("moz-extension:")||"moz-extension:"===window.location.protocol)&&(i="*"),o="function"==typeof s.match?s.match(/^__cross_frame_dhcp_(discovery|offer|request|ack)(?::(\d+))?$/):void 0,o&&(t=o[1],p=o[2],n=this._processMessage(t,p,i),c=n.reply,r=n.discovered,p=n.token,c&&a.postMessage("__cross_frame_dhcp_"+c,i),r&&this.onDiscovery.call(null,a,i,p))},e.prototype._processMessage=function(e,s,r){var o,t;if(t=null,o=!1,this.server){if("discovery"===e)t="offer";else if("request"===e)s=this._generateToken(),t="ack:"+s,o=!0;else if("offer"===e||"ack"===e)throw new Error("A second Discovery server has been detected at "+r+".\nThis is unsupported and will cause unexpected behaviour.")}else"offer"===e?this.requestInProgress||(this.requestInProgress=!0,t="request"):"ack"===e&&(this.requestInProgress=!1,o=!0);return{reply:t,discovered:o,token:s}},e.prototype._generateToken=function(){return(""+Math.random()).replace(/\D/g,"")},e}();

},{}],22:[function(require,module,exports){
function RPC(e,t,s,o){if(!(this instanceof RPC))return new RPC(e,t,s,o);var r=this;if(this.src=e,this.dst=t,"*"===s)this.origin="*";else{var i=new URL(s);this.origin=i.protocol+"//"+i.host}this._sequence=0,this._callbacks={},this._onmessage=function(e){r._destroyed||"*"!==r.origin&&e.origin!==r.origin||e.data&&"object"==typeof e.data&&"frame-rpc"===e.data.protocol&&Array.isArray(e.data.arguments)&&r._handle(e.data)},this.src.addEventListener("message",this._onmessage),this._methods=("function"==typeof o?o(this):o)||{}}var VERSION="1.0.0";module.exports=RPC,RPC.prototype.destroy=function(){this._destroyed=!0,this.src.removeEventListener("message",this._onmessage)},RPC.prototype.call=function(e){var t=[].slice.call(arguments,1);return this.apply(e,t)},RPC.prototype.apply=function(e,t){if(!this._destroyed){var s=this._sequence++;"function"==typeof t[t.length-1]&&(this._callbacks[s]=t[t.length-1],t=t.slice(0,-1)),this.dst.postMessage({protocol:"frame-rpc",version:VERSION,sequence:s,method:e,arguments:t},this.origin)}},RPC.prototype._handle=function(e){var t=this;if(!t._destroyed)if(e.hasOwnProperty("method")){if(!this._methods.hasOwnProperty(e.method))return;var s=e.arguments.concat(function(){t.dst.postMessage({protocol:"frame-rpc",version:VERSION,response:e.sequence,arguments:[].slice.call(arguments)},t.origin)});this._methods[e.method].apply(this._methods,s)}else if(e.hasOwnProperty("response")){var o=this._callbacks[e.response];delete this._callbacks[e.response],o&&o.apply(null,e.arguments)}};

},{}],23:[function(require,module,exports){
"use strict";function settings(t,e){e||(e="js-hypothesis-settings");for(var s=t.querySelectorAll("script."+e),r={},n=0;n<s.length;n++)Object.assign(r,JSON.parse(s[n].textContent));return r}require("core-js/fn/object/assign"),module.exports=settings;

},{"core-js/fn/object/assign":29}],24:[function(require,module,exports){
"use strict";function extractIDFromURL(t){try{var r=t.match(/#annotations:([A-Za-z0-9_-]+)$/);return r?r[1]:null}catch(a){return null}}module.exports={extractIDFromURL:extractIDFromURL};

},{}],25:[function(require,module,exports){
(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,a=function(t,e){function a(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return a.prototype=e.prototype,t.prototype=new a,t.__super__=e.prototype,t};Annotator.Plugin.Document=function(i){function r(){return this._getFavicon=e(this._getFavicon,this),this._getLinks=e(this._getLinks,this),this._getTitle=e(this._getTitle,this),this._getMetaTags=e(this._getMetaTags,this),this._getEprints=e(this._getEprints,this),this._getPrism=e(this._getPrism,this),this._getDublinCore=e(this._getDublinCore,this),this._getTwitter=e(this._getTwitter,this),this._getFacebook=e(this._getFacebook,this),this._getHighwire=e(this._getHighwire,this),this.getDocumentMetadata=e(this.getDocumentMetadata,this),this.beforeAnnotationCreated=e(this.beforeAnnotationCreated,this),this.uris=e(this.uris,this),this.uri=e(this.uri,this),t=r.__super__.constructor.apply(this,arguments)}var n;return a(r,i),n=Annotator.$,r.prototype.events={beforeAnnotationCreated:"beforeAnnotationCreated"},r.prototype.pluginInit=function(){return this.getDocumentMetadata()},r.prototype.uri=function(){var t,e,i,a,r;for(e=decodeURIComponent(document.location.href),r=this.metadata.link,i=0,a=r.length;a>i;i++)t=r[i],"canonical"===t.rel&&(e=t.href);return e},r.prototype.uris=function(){var t,e,i,a,r,n;for(i={},n=this.metadata.link,a=0,r=n.length;r>a;a++)e=n[a],e.href&&(i[e.href]=!0);return function(){var e;e=[];for(t in i)e.push(t);return e}()},r.prototype.beforeAnnotationCreated=function(t){return t.document=this.metadata},r.prototype.getDocumentMetadata=function(){return this.metadata={},this._getHighwire(),this._getDublinCore(),this._getFacebook(),this._getEprints(),this._getPrism(),this._getTwitter(),this._getFavicon(),this._getTitle(),this._getLinks(),this.metadata},r.prototype._getHighwire=function(){return this.metadata.highwire=this._getMetaTags("citation","name","_")},r.prototype._getFacebook=function(){return this.metadata.facebook=this._getMetaTags("og","property",":")},r.prototype._getTwitter=function(){return this.metadata.twitter=this._getMetaTags("twitter","name",":")},r.prototype._getDublinCore=function(){return this.metadata.dc=this._getMetaTags("dc","name",".")},r.prototype._getPrism=function(){return this.metadata.prism=this._getMetaTags("prism","name",".")},r.prototype._getEprints=function(){return this.metadata.eprints=this._getMetaTags("eprints","name",".")},r.prototype._getMetaTags=function(t,e,i){var a,r,o,s,h,p,u,l,g;for(p={},g=n("meta"),u=0,l=g.length;l>u;u++)o=g[u],h=n(o).attr(e),a=n(o).prop("content"),h&&(r=h.match(RegExp("^"+t+i+"(.+)$","i")),r&&(s=r[1],p[s]?p[s].push(a):p[s]=[a]));return p},r.prototype._getTitle=function(){return this.metadata.highwire.title?this.metadata.title=this.metadata.highwire.title[0]:this.metadata.eprints.title?this.metadata.title=this.metadata.eprints.title[0]:this.metadata.prism.title?this.metadata.title=this.metadata.prism.title[0]:this.metadata.facebook.title?this.metadata.title=this.metadata.facebook.title[0]:this.metadata.twitter.title?this.metadata.title=this.metadata.twitter.title[0]:this.metadata.dc.title?this.metadata.title=this.metadata.dc.title[0]:this.metadata.title=n("head title").text()},r.prototype._getLinks=function(){var t,e,i,a,r,o,s,h,p,u,l,g,c,f,d,m,_,y,k,b,v;for(this.metadata.link=[{href:document.location.href}],y=n("link"),g=0,d=y.length;d>g;g++)if(o=y[g],a=n(o),e=this._absoluteUrl(a.prop("href")),h=a.prop("rel"),p=a.prop("type"),r=a.prop("hreflang"),"alternate"===h||"canonical"===h||"bookmark"===h||"shortlink"===h){if("alternate"===h){if(p&&p.match(/^application\/(rss|atom)\+xml/))continue;if(r)continue}this.metadata.link.push({href:e,rel:h,type:p})}k=this.metadata.highwire;for(s in k){if(l=k[s],"pdf_url"===s)for(c=0,m=l.length;m>c;c++)u=l[c],this.metadata.link.push({href:this._absoluteUrl(u),type:"application/pdf"});if("doi"===s)for(f=0,_=l.length;_>f;f++)t=l[f],"doi:"!==t.slice(0,4)&&(t="doi:"+t),this.metadata.link.push({href:t})}b=this.metadata.dc,v=[];for(s in b)l=b[s],"identifier"===s?v.push(function(){var t,e,a;for(a=[],t=0,e=l.length;e>t;t++)i=l[t],"doi:"===i.slice(0,4)?a.push(this.metadata.link.push({href:i})):a.push(void 0);return a}.call(this)):v.push(void 0);return v},r.prototype._getFavicon=function(){var t,e,i,a,r,o;for(a=n("link"),o=[],e=0,i=a.length;i>e;e++)t=a[e],"shortcut icon"===(r=n(t).prop("rel"))||"icon"===r?o.push(this.metadata.favicon=this._absoluteUrl(t.href)):o.push(void 0);return o},r.prototype._absoluteUrl=function(t){var e;return e=document.createElement("a"),e.href=t,e.href},r}(Annotator.Plugin)}).call(this);

},{}],26:[function(require,module,exports){
(function (global){
jQuery=global.jQuery=require("jquery");var __browserify_shim_require__=require;(function(t,e,n,o,i){(function(){var t,e,n,o,i,r,s,a,l,u,h,d,c,p,f,m,g,v,y,w,E,b,N,C,_=[].slice,O={}.hasOwnProperty,T=function(t,e){function n(){this.constructor=t}for(var o in e)O.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},x=function(t,e){return function(){return t.apply(e,arguments)}};if(p=function(e){var n;return n=this.map(function(){var n,o,i,r;for(i="",n=this;(null!=n?n.nodeType:void 0)===Node.ELEMENT_NODE&&n!==e;)r=n.tagName.replace(":","\\:"),o=t(n.parentNode).children(r).index(n)+1,o="["+o+"]",i="/"+n.tagName.toLowerCase()+o+i,n=n.parentNode;return i}),n.get()},f=function(t){var e,n,o,i;return e=function(t){var e,n;return e=h(t),n=d(t),""+e+"["+n+"]"},i=t,n=function(t){var n;for(n="";t!==i;){if(null==t)throw new Error("Called getPathTo on a node which was not a descendant of @rootNode. "+i);n=e(t)+"/"+n,t=t.parentNode}return n="/"+n,n=n.replace(/\/$/,"")},o=this.map(function(){var t;return t=n(this)}),o.get()},s=function(t,e,n){var o,i,r,s,a,l;if(!t.hasChildNodes())throw new Error("XPath error: node has no children!");for(i=t.childNodes,r=0,a=0,l=i.length;l>a;a++)if(o=i[a],s=h(o),s===e&&(r+=1,r===n))return o;throw new Error("XPath error: wanted child not found.")},h=function(t){var e;switch(e=t.nodeName.toLowerCase()){case"#text":return"text()";case"#comment":return"comment()";case"#cdata-section":return"cdata-section()";default:return e}},d=function(t){var e,n;for(e=0,n=t;n;)n.nodeName===t.nodeName&&e++,n=n.previousSibling;return e},c=null,"undefined"!=typeof Gettext&&null!==Gettext?(g=new Gettext({domain:"annotator"}),c=function(t){return g.gettext(t)}):c=function(t){return t},C=function(t){return c(t)},("undefined"!=typeof jQuery&&null!==jQuery&&null!=(b=jQuery.fn)?b.jquery:void 0)||console.error(C("Annotator requires jQuery: have you included lib/vendor/jquery.js?")),JSON&&JSON.parse&&JSON.stringify||console.error(C("Annotator requires a JSON implementation: have you included lib/vendor/json2.js?")),t=jQuery,r={},r.flatten=function(e){var n;return(n=function(e){var o,i,r,s;for(i=[],r=0,s=e.length;s>r;r++)o=e[r],i=i.concat(o&&t.isArray(o)?n(o):o);return i})(e)},r.contains=function(t,e){var n;for(n=e;null!=n;){if(n===t)return!0;n=n.parentNode}return!1},r.getTextNodes=function(t){var e;return e=function(t){var n;if(t&&t.nodeType!==Node.TEXT_NODE){if(n=[],t.nodeType!==Node.COMMENT_NODE)for(t=t.lastChild;t;)n.push(e(t)),t=t.previousSibling;return n.reverse()}return t},t.map(function(){return r.flatten(e(this))})},r.getLastTextNodeUpTo=function(t){var e;switch(t.nodeType){case Node.TEXT_NODE:return t;case Node.ELEMENT_NODE:if(null!=t.lastChild&&(e=r.getLastTextNodeUpTo(t.lastChild),null!=e))return e}return t=t.previousSibling,null!=t?r.getLastTextNodeUpTo(t):null},r.getFirstTextNodeNotBefore=function(t){var e;switch(t.nodeType){case Node.TEXT_NODE:return t;case Node.ELEMENT_NODE:if(null!=t.firstChild&&(e=r.getFirstTextNodeNotBefore(t.firstChild),null!=e))return e}return t=t.nextSibling,null!=t?r.getFirstTextNodeNotBefore(t):null},r.readRangeViaSelection=function(t){var e;return e=r.getGlobal().getSelection(),e.removeAllRanges(),e.addRange(t.toRange()),e.toString()},r.xpathFromNode=function(t,e){var n,o;try{o=p.call(t,e)}catch(i){n=i,console.log("jQuery-based XPath construction failed! Falling back to manual."),o=f.call(t,e)}return o},r.nodeFromXPath=function(t,e){var n,o,i,r,a,l,u,h;for(a=t.substring(1).split("/"),i=e,l=0,u=a.length;u>l;l++)r=a[l],h=r.split("["),o=h[0],n=h[1],n=null!=n?parseInt((null!=n?n.split("]"):void 0)[0]):1,i=s(i,o.toLowerCase(),n);return i},r.escape=function(t){return t.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},r.uuid=function(){var t;return t=0,function(){return t++}}(),r.getGlobal=function(){return function(){return this}()},r.maxZIndex=function(e){var n,o;return n=function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)o=e[n],"static"===t(o).css("position")?r.push(-1):r.push(parseFloat(t(o).css("z-index"))||-1);return r}(),Math.max.apply(Math,n)},r.mousePosition=function(e,n){var o,i;return"absolute"!==(i=t(n).css("position"))&&"fixed"!==i&&"relative"!==i&&(n=t(n).offsetParent()[0]),o=t(n).offset(),{top:e.pageY-o.top,left:e.pageX-o.left}},r.preventEventDefault=function(t){return null!=t&&"function"==typeof t.preventDefault?t.preventDefault():void 0},l=["log","debug","info","warn","exception","assert","dir","dirxml","trace","group","groupEnd","groupCollapsed","time","timeEnd","profile","profileEnd","count","clear","table","error","notifyFirebug","firebug","userObjects"],"undefined"!=typeof console&&null!==console)for(null==console.group&&(console.group=function(t){return console.log("GROUP: ",t)}),null==console.groupCollapsed&&(console.groupCollapsed=console.group),v=0,w=l.length;w>v;v++)a=l[v],null==console[a]&&(console[a]=function(){return console.log(C("Not implemented:")+(" console."+name))});else{for(this.console={},y=0,E=l.length;E>y;y++)a=l[y],this.console[a]=function(){};this.console.error=function(){var t;return t=1<=arguments.length?_.call(arguments,0):[],alert("ERROR: "+t.join(", "))},this.console.warn=function(){var t;return t=1<=arguments.length?_.call(arguments,0):[],alert("WARNING: "+t.join(", "))}}n=function(){function e(e,n){this.options=t.extend(!0,{},this.options,n),this.element=t(e),this._closures={},this.on=this.subscribe,this.addEvents()}return e.prototype.events={},e.prototype.options={},e.prototype.element=null,e.prototype.destroy=function(){return this.removeEvents()},e.prototype.addEvents=function(){var t,n,o,i,r;for(i=e._parseEvents(this.events),r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(this._addEvent(t.selector,t.event,t.functionName));return r},e.prototype.removeEvents=function(){var t,n,o,i,r;for(i=e._parseEvents(this.events),r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(this._removeEvent(t.selector,t.event,t.functionName));return r},e.prototype._addEvent=function(t,n,o){var i,r=this;return i=function(){return r[o].apply(r,arguments)},""===t&&e._isCustomEvent(n)?this.subscribe(n,i):this.element.delegate(t,n,i),this._closures[""+t+"/"+n+"/"+o]=i,this},e.prototype._removeEvent=function(t,n,o){var i;return i=this._closures[""+t+"/"+n+"/"+o],""===t&&e._isCustomEvent(n)?this.unsubscribe(n,i):this.element.undelegate(t,n,i),delete this._closures[""+t+"/"+n+"/"+o],this},e.prototype.publish=function(){return this.element.triggerHandler.apply(this.element,arguments),this},e.prototype.subscribe=function(e,n){var o;return o=function(){return n.apply(this,[].slice.call(arguments,1))},o.guid=n.guid=t.guid+=1,this.element.bind(e,o),this},e.prototype.unsubscribe=function(){return this.element.unbind.apply(this.element,arguments),this},e}(),n._parseEvents=function(t){var e,n,o,i,r,s,a;n=[];for(i in t)o=t[i],a=i.split(" "),r=2<=a.length?_.call(a,0,s=a.length-1):(s=0,[]),e=a[s++],n.push({selector:r.join(" "),event:e,functionName:o});return n},n.natives=function(){var t,e,n;return e=function(){var e,o;e=jQuery.event.special,o=[];for(t in e)O.call(e,t)&&(n=e[t],o.push(t));return o}(),"blur focus focusin focusout load resize scroll unload click dblclick\nmousedown mouseup mousemove mouseover mouseout mouseenter mouseleave\nchange select submit keydown keypress keyup error".split(/[^a-z]+/).concat(e)}(),n._isCustomEvent=function(e){return e=e.split(".")[0],-1===t.inArray(e,n.natives)},i={},i.sniff=function(t){return null!=t.commonAncestorContainer?new i.BrowserRange(t):"string"==typeof t.start?new i.SerializedRange(t):t.start&&"object"==typeof t.start?new i.NormalizedRange(t):(console.error(C("Could not sniff range type")),!1)},i.nodeFromXPath=function(e,n){var o,i,s,a,l;return null==n&&(n=document),i=function(t,e){var o;null==e&&(e=null);try{return document.evaluate("."+t,n,e,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(i){return o=i,console.log("XPath evaluation failed."),console.log("Trying fallback..."),r.nodeFromXPath(t,n)}},t.isXMLDoc(document.documentElement)?(o=document.createNSResolver(null===document.ownerDocument?document.documentElement:document.ownerDocument.documentElement),a=i(e,o),a||(e=function(){var t,n,o,i;for(o=e.split("/"),i=[],t=0,n=o.length;n>t;t++)l=o[t],l&&-1===l.indexOf(":")?i.push(l.replace(/^([a-z]+)/,"xhtml:$1")):i.push(l);return i}().join("/"),s=document.lookupNamespaceURI(null),o=function(t){return"xhtml"===t?s:document.documentElement.getAttribute("xmlns:"+t)},a=i(e,o)),a):i(e)},i.RangeError=function(t){function e(t,n,o){this.type=t,this.message=n,this.parent=null!=o?o:null,e.__super__.constructor.call(this,this.message)}return T(e,t),e}(Error),i.BrowserRange=function(){function t(t){this.commonAncestorContainer=t.commonAncestorContainer,this.startContainer=t.startContainer,this.startOffset=t.startOffset,this.endContainer=t.endContainer,this.endOffset=t.endOffset}return t.prototype.normalize=function(t){var e,n,o,s;if(this.tainted)return console.error(C("You may only call normalize() once on a BrowserRange!")),!1;if(this.tainted=!0,s={},this.startContainer.nodeType===Node.ELEMENT_NODE?(s.start=r.getFirstTextNodeNotBefore(this.startContainer.childNodes[this.startOffset]),s.startOffset=0):(s.start=this.startContainer,s.startOffset=this.startOffset),this.endContainer.nodeType===Node.ELEMENT_NODE){if(n=this.endContainer.childNodes[this.endOffset],null!=n){for(e=n;null!=e&&e.nodeType!==Node.TEXT_NODE;)e=e.firstChild;null!=e&&(s.end=e,s.endOffset=0)}null==s.end&&(n=this.endContainer.childNodes[this.endOffset-1],s.end=r.getLastTextNodeUpTo(n),s.endOffset=s.end.nodeValue.length)}else s.end=this.endContainer,s.endOffset=this.endOffset;for(o={},s.startOffset>0?s.start.nodeValue.length>s.startOffset?o.start=s.start.splitText(s.startOffset):o.start=s.start.nextSibling:o.start=s.start,s.start===s.end?(o.start.nodeValue.length>s.endOffset-s.startOffset&&o.start.splitText(s.endOffset-s.startOffset),o.end=o.start):(s.end.nodeValue.length>s.endOffset&&s.end.splitText(s.endOffset),o.end=s.end),o.commonAncestor=this.commonAncestorContainer;o.commonAncestor.nodeType!==Node.ELEMENT_NODE;)o.commonAncestor=o.commonAncestor.parentNode;return new i.NormalizedRange(o)},t.prototype.serialize=function(t,e){return this.normalize(t).serialize(t,e)},t}(),i.NormalizedRange=function(){function e(t){this.commonAncestor=t.commonAncestor,this.start=t.start,this.end=t.end}return e.prototype.normalize=function(t){return this},e.prototype.limit=function(e){var n,o,i,r,s,a;if(n=t.grep(this.textNodes(),function(n){return n.parentNode===e||t.contains(e,n.parentNode)}),!n.length)return null;for(this.start=n[0],this.end=n[n.length-1],i=t(this.start).parents(),a=t(this.end).parents(),r=0,s=a.length;s>r;r++)if(o=a[r],-1!==i.index(o)){this.commonAncestor=o;break}return this},e.prototype.serialize=function(e,n){var o,s,a;return s=function(o,i){var s,a,l,u,h,d,c,p;for(u=n?t(o).parents(":not("+n+")").eq(0):t(o).parent(),d=r.xpathFromNode(u,e)[0],h=r.getTextNodes(u),a=h.slice(0,h.index(o)),l=0,c=0,p=a.length;p>c;c++)s=a[c],l+=s.nodeValue.length;return i?[d,l+o.nodeValue.length]:[d,l]},a=s(this.start),o=s(this.end,!0),new i.SerializedRange({start:a[0],end:o[0],startOffset:a[1],endOffset:o[1]})},e.prototype.text=function(){var t;return function(){var e,n,o,i;for(o=this.textNodes(),i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(t.nodeValue);return i}.call(this).join("")},e.prototype.textNodes=function(){var e,n,o,i;return o=r.getTextNodes(t(this.commonAncestor)),i=[o.index(this.start),o.index(this.end)],n=i[0],e=i[1],t.makeArray(o.slice(n,+e+1||9e9))},e.prototype.toRange=function(){var t;return t=document.createRange(),t.setStartBefore(this.start),t.setEndAfter(this.end),t},e}(),i.SerializedRange=function(){function e(t){this.start=t.start,this.startOffset=t.startOffset,this.end=t.end,this.endOffset=t.endOffset}return e.prototype.normalize=function(e){var n,o,s,a,l,u,h,d,c,p,f,m,g,v;for(u={},g=["start","end"],c=0,f=g.length;f>c;c++){l=g[c];try{a=i.nodeFromXPath(this[l],e)}catch(y){throw o=y,new i.RangeError(l,"Error while finding "+l+" node: "+this[l]+": "+o,o)}if(!a)throw new i.RangeError(l,"Couldn't find "+l+" node: "+this[l]);for(s=0,h=this[l+"Offset"],"end"===l&&h--,v=r.getTextNodes(t(a)),p=0,m=v.length;m>p;p++){if(d=v[p],s+d.nodeValue.length>h){u[l+"Container"]=d,u[l+"Offset"]=this[l+"Offset"]-s;break}s+=d.nodeValue.length}if(null==u[l+"Offset"])throw new i.RangeError(""+l+"offset","Couldn't find offset "+this[l+"Offset"]+" in element "+this[l])}return n=null==document.compareDocumentPosition?function(t,e){return t.contains(e)}:function(t,e){return 16&t.compareDocumentPosition(e)},t(u.startContainer).parents().each(function(){return n(this,u.endContainer)?(u.commonAncestorContainer=this,!1):void 0}),new i.BrowserRange(u).normalize(e)},e.prototype.serialize=function(t,e){return this.normalize(t).serialize(t,e)},e.prototype.toObject=function(){return{start:this.start,startOffset:this.startOffset,end:this.end,endOffset:this.endOffset}},e}(),m=this.Annotator,e=function(e){function n(e,o){return this.onDeleteAnnotation=x(this.onDeleteAnnotation,this),this.onEditAnnotation=x(this.onEditAnnotation,this),this.onAdderClick=x(this.onAdderClick,this),this.onAdderMousedown=x(this.onAdderMousedown,this),this.onHighlightMouseover=x(this.onHighlightMouseover,this),this.checkForEndSelection=x(this.checkForEndSelection,this),this.checkForStartSelection=x(this.checkForStartSelection,this),this.clearViewerHideTimer=x(this.clearViewerHideTimer,this),this.startViewerHideTimer=x(this.startViewerHideTimer,this),this.showViewer=x(this.showViewer,this),this.onEditorSubmit=x(this.onEditorSubmit,this),this.onEditorHide=x(this.onEditorHide,this),this.showEditor=x(this.showEditor,this),n.__super__.constructor.apply(this,arguments),this.plugins={},n.supported()?(this.options.readOnly||this._setupDocumentEvents(),this._setupWrapper()._setupViewer()._setupEditor(),this._setupDynamicStyle(),this.adder=t(this.html.adder).appendTo(this.wrapper).hide(),void n._instances.push(this)):this}return T(n,e),n.prototype.events={".annotator-adder button click":"onAdderClick",".annotator-adder button mousedown":"onAdderMousedown",".annotator-hl mouseover":"onHighlightMouseover",".annotator-hl mouseout":"startViewerHideTimer"},n.prototype.html={adder:'<div class="annotator-adder"><button>'+C("Annotate")+"</button></div>",wrapper:'<div class="annotator-wrapper"></div>'},n.prototype.options={readOnly:!1},n.prototype.plugins={},n.prototype.editor=null,n.prototype.viewer=null,n.prototype.selectedRanges=null,n.prototype.mouseIsDown=!1,n.prototype.ignoreMouseup=!1,n.prototype.viewerHideTimer=null,n.prototype._setupWrapper=function(){return this.wrapper=t(this.html.wrapper),this.element.find("script").remove(),this.element.wrapInner(this.wrapper),this.wrapper=this.element.find(".annotator-wrapper"),this},n.prototype._setupViewer=function(){var e=this;return this.viewer=new n.Viewer({readOnly:this.options.readOnly}),this.viewer.hide().on("edit",this.onEditAnnotation).on("delete",this.onDeleteAnnotation).addField({load:function(n,o){return o.text?t(n).html(r.escape(o.text)):t(n).html("<i>"+C("No Comment")+"</i>"),e.publish("annotationViewerTextField",[n,o])}}).element.appendTo(this.wrapper).bind({mouseover:this.clearViewerHideTimer,mouseout:this.startViewerHideTimer}),this},n.prototype._setupEditor=function(){return this.editor=new n.Editor,this.editor.hide().on("hide",this.onEditorHide).on("save",this.onEditorSubmit).addField({type:"textarea",label:C("Comments")+"â€¦",load:function(e,n){return t(e).find("textarea").val(n.text||"")},submit:function(e,n){return n.text=t(e).find("textarea").val()}}),this.editor.element.appendTo(this.wrapper),this},n.prototype._setupDocumentEvents=function(){return t(document).bind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection}),this},n.prototype._setupDynamicStyle=function(){var e,n,o,i;return o=t("#annotator-dynamic-style"),o.length||(o=t('<style id="annotator-dynamic-style"></style>').appendTo(document.head)),n="*"+function(){var t,e,n,o;for(n=["adder","outer","notice","filter"],o=[],t=0,e=n.length;e>t;t++)i=n[t],o.push(":not(.annotator-"+i+")");return o}().join(""),e=r.maxZIndex(t(document.body).find(n)),e=Math.max(e,1e3),o.text([".annotator-adder, .annotator-outer, .annotator-notice {","  z-index: "+(e+20)+";","}",".annotator-filter {","  z-index: "+(e+10)+";","}"].join("\n")),this},n.prototype.destroy=function(){var e,o,i,r,s;n.__super__.destroy.apply(this,arguments),t(document).unbind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection}),t("#annotator-dynamic-style").remove(),this.adder.remove(),this.viewer.destroy(),this.editor.destroy(),this.wrapper.find(".annotator-hl").each(function(){return t(this).contents().insertBefore(this),t(this).remove()}),this.wrapper.contents().insertBefore(this.wrapper),this.wrapper.remove(),this.element.data("annotator",null),s=this.plugins;for(o in s)i=s[o],"function"==typeof(r=this.plugins[o]).destroy&&r.destroy();return e=n._instances.indexOf(this),-1!==e?n._instances.splice(e,1):void 0},n.prototype.getSelectedRanges=function(){var e,n,o,s,a,l,u,h,d;for(u=r.getGlobal().getSelection(),a=[],l=[],u.isCollapsed||(a=function(){var t,r,a;for(a=[],n=t=0,r=u.rangeCount;r>=0?r>t:t>r;n=r>=0?++t:--t)s=u.getRangeAt(n),e=new i.BrowserRange(s),o=e.normalize().limit(this.wrapper[0]),null===o&&l.push(s),a.push(o);return a}.call(this),u.removeAllRanges()),h=0,d=l.length;d>h;h++)s=l[h],u.addRange(s);return t.grep(a,function(t){return t&&u.addRange(t.toRange()),t})},n.prototype.createAnnotation=function(){var t;return t={},this.publish("beforeAnnotationCreated",[t]),t},n.prototype.setupAnnotation=function(e){var n,o,r,s,a,l,u,h,d,c;for(a=this.wrapper[0],e.ranges||(e.ranges=this.selectedRanges),r=[],c=e.ranges,l=0,h=c.length;h>l;l++){s=c[l];try{r.push(i.sniff(s).normalize(a))}catch(p){if(n=p,!(n instanceof i.RangeError))throw n;this.publish("rangeNormalizeFail",[e,s,n])}}for(e.quote=[],e.ranges=[],e.highlights=[],u=0,d=r.length;d>u;u++)o=r[u],e.quote.push(t.trim(o.text())),e.ranges.push(o.serialize(this.wrapper[0],".annotator-hl")),t.merge(e.highlights,this.highlightRange(o));return e.quote=e.quote.join(" / "),t(e.highlights).data("annotation",e),t(e.highlights).attr("data-annotation-id",e.id),e},n.prototype.updateAnnotation=function(e){return this.publish("beforeAnnotationUpdated",[e]),t(e.highlights).attr("data-annotation-id",e.id),this.publish("annotationUpdated",[e]),e},n.prototype.deleteAnnotation=function(e){var n,o,i,r,s;if(null!=e.highlights)for(s=e.highlights,i=0,r=s.length;r>i;i++)o=s[i],null!=o.parentNode&&(n=o.childNodes[0],t(o).replaceWith(o.childNodes));return this.publish("annotationDeleted",[e]),e},n.prototype.loadAnnotations=function(t){var e,n,o=this;return null==t&&(t=[]),n=function(t){var i,r,s,a;for(null==t&&(t=[]),r=t.splice(0,10),s=0,a=r.length;a>s;s++)i=r[s],o.setupAnnotation(i);return t.length>0?setTimeout(function(){return n(t)},10):o.publish("annotationsLoaded",[e])},e=t.slice(),n(t),this},n.prototype.dumpAnnotations=function(){return this.plugins.Store?this.plugins.Store.dumpAnnotations():(console.warn(C("Can't dump annotations without Store plugin.")),!1)},n.prototype.highlightRange=function(e,n){var o,i,r,s,a,l,u;for(null==n&&(n="annotator-hl"),r=/^\s*$/,o=t("<span class='"+n+"'></span>"),l=e.textNodes(),u=[],s=0,a=l.length;a>s;s++)i=l[s],r.test(i.nodeValue)||u.push(t(i).wrapAll(o).parent().show()[0]);return u},n.prototype.highlightRanges=function(e,n){var o,i,r,s;for(null==n&&(n="annotator-hl"),o=[],r=0,s=e.length;s>r;r++)i=e[r],t.merge(o,this.highlightRange(i,n));return o},n.prototype.addPlugin=function(t,e){var o,i;return this.plugins[t]?console.error(C("You cannot have more than one instance of any plugin.")):(o=n.Plugin[t],"function"==typeof o?(this.plugins[t]=new o(this.element[0],e),this.plugins[t].annotator=this,"function"==typeof(i=this.plugins[t]).pluginInit&&i.pluginInit()):console.error(C("Could not load ")+t+C(" plugin. Have you included the appropriate <script> tag?"))),this},n.prototype.showEditor=function(t,e){return this.editor.element.css(e),this.editor.load(t),this.publish("annotationEditorShown",[this.editor,t]),this},n.prototype.onEditorHide=function(){return this.publish("annotationEditorHidden",[this.editor]),this.ignoreMouseup=!1},n.prototype.onEditorSubmit=function(t){return this.publish("annotationEditorSubmit",[this.editor,t])},n.prototype.showViewer=function(t,e){return this.viewer.element.css(e),this.viewer.load(t),this.publish("annotationViewerShown",[this.viewer,t])},n.prototype.startViewerHideTimer=function(){return this.viewerHideTimer?void 0:this.viewerHideTimer=setTimeout(this.viewer.hide,250)},n.prototype.clearViewerHideTimer=function(){return clearTimeout(this.viewerHideTimer),this.viewerHideTimer=!1},n.prototype.checkForStartSelection=function(t){return t&&this.isAnnotator(t.target)||this.startViewerHideTimer(),this.mouseIsDown=!0},n.prototype.checkForEndSelection=function(t){var e,n,o,i,s;if(this.mouseIsDown=!1,!this.ignoreMouseup){for(this.selectedRanges=this.getSelectedRanges(),s=this.selectedRanges,o=0,i=s.length;i>o;o++)if(n=s[o],e=n.commonAncestor,this.isAnnotator(e))return;return t&&this.selectedRanges.length?this.adder.css(r.mousePosition(t,this.wrapper[0])).show():this.adder.hide()}},n.prototype.isAnnotator=function(e){return!!t(e).parents().addBack().filter("[class^=annotator-]").not("[class=annotator-hl]").not(this.wrapper).length},n.prototype.onHighlightMouseover=function(e){var n;return this.clearViewerHideTimer(),this.mouseIsDown?!1:(this.viewer.isShown()&&this.viewer.hide(),n=t(e.target).parents(".annotator-hl").addBack().map(function(){return t(this).data("annotation")}).toArray(),this.showViewer(n,r.mousePosition(e,this.wrapper[0])))},n.prototype.onAdderMousedown=function(t){return null!=t&&t.preventDefault(),this.ignoreMouseup=!0},n.prototype.onAdderClick=function(e){var n,o,i,r,s,a=this;return null!=e&&e.preventDefault(),r=this.adder.position(),this.adder.hide(),n=this.setupAnnotation(this.createAnnotation()),t(n.highlights).addClass("annotator-hl-temporary"),s=function(){return i(),t(n.highlights).removeClass("annotator-hl-temporary"),a.publish("annotationCreated",[n])},o=function(){return i(),a.deleteAnnotation(n)},i=function(){return a.unsubscribe("annotationEditorHidden",o),a.unsubscribe("annotationEditorSubmit",s)},this.subscribe("annotationEditorHidden",o),this.subscribe("annotationEditorSubmit",s),this.showEditor(n,r)},n.prototype.onEditAnnotation=function(t){var e,n,o,i=this;return n=this.viewer.element.position(),o=function(){return e(),i.updateAnnotation(t)},e=function(){return i.unsubscribe("annotationEditorHidden",e),i.unsubscribe("annotationEditorSubmit",o)},this.subscribe("annotationEditorHidden",e),this.subscribe("annotationEditorSubmit",o),this.viewer.hide(),this.showEditor(t,n)},n.prototype.onDeleteAnnotation=function(t){return this.viewer.hide(),this.deleteAnnotation(t)},n}(n),e.Plugin=function(t){function e(t,n){e.__super__.constructor.apply(this,arguments)}return T(e,t),e.prototype.pluginInit=function(){},e}(n),u=r.getGlobal(),null==(null!=(N=u.document)?N.evaluate:void 0)&&t.getScript("http://assets.annotateit.org/vendor/xpath.min.js"),null==u.getSelection&&t.getScript("http://assets.annotateit.org/vendor/ierange.min.js"),null==u.JSON&&t.getScript("http://assets.annotateit.org/vendor/json2.min.js"),null==u.Node&&(u.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),e.$=t,e.Delegator=n,e.Range=i,e.Util=r,e._instances=[],e._t=C,e.supported=function(){return function(){return!!this.getSelection}()},e.noConflict=function(){return r.getGlobal().Annotator=m,this},t.fn.annotator=function(n){var o;return o=Array.prototype.slice.call(arguments,1),this.each(function(){var i;return i=t.data(this,"annotator"),"destroy"===n?(t.removeData(this,"annotator"),null!=i?i.destroy(o):void 0):i?n&&i[n].apply(i,o):(i=new e(this,n),t.data(this,"annotator",i))})},this.Annotator=e,e.Widget=function(n){function o(n,i){o.__super__.constructor.apply(this,arguments),this.classes=t.extend({},e.Widget.prototype.classes,this.classes)}return T(o,n),o.prototype.classes={hide:"annotator-hide",invert:{x:"annotator-invert-x",y:"annotator-invert-y"}},o.prototype.destroy=function(){return this.removeEvents(),this.element.remove()},o.prototype.checkOrientation=function(){var n,o,i,r,s;return this.resetOrientation(),s=t(e.Util.getGlobal()),r=this.element.children(":first"),o=r.offset(),i={top:s.scrollTop(),right:s.width()+s.scrollLeft()},n={top:o.top,right:o.left+r.width()},n.top-i.top<0&&this.invertY(),n.right-i.right>0&&this.invertX(),this},o.prototype.resetOrientation=function(){return this.element.removeClass(this.classes.invert.x).removeClass(this.classes.invert.y),this},o.prototype.invertX=function(){return this.element.addClass(this.classes.invert.x),this},o.prototype.invertY=function(){return this.element.addClass(this.classes.invert.y),this},o.prototype.isInvertedY=function(){return this.element.hasClass(this.classes.invert.y)},o.prototype.isInvertedX=function(){return this.element.hasClass(this.classes.invert.x)},o}(n),e.Editor=function(n){function o(e){this.onCancelButtonMouseover=x(this.onCancelButtonMouseover,this),this.processKeypress=x(this.processKeypress,this),this.submit=x(this.submit,this),this.load=x(this.load,this),this.hide=x(this.hide,this),this.show=x(this.show,this),o.__super__.constructor.call(this,t(this.html)[0],e),this.fields=[],this.annotation={}}return T(o,n),o.prototype.events={"form submit":"submit",".annotator-save click":"submit",".annotator-cancel click":"hide",".annotator-cancel mouseover":"onCancelButtonMouseover","textarea keydown":"processKeypress"},o.prototype.classes={hide:"annotator-hide",focus:"annotator-focus"},o.prototype.html='<div class="annotator-outer annotator-editor">\n  <form class="annotator-widget">\n    <ul class="annotator-listing"></ul>\n    <div class="annotator-controls">\n      <a href="#cancel" class="annotator-cancel">'+C("Cancel")+'</a>\n<a href="#save" class="annotator-save annotator-focus">'+C("Save")+"</a>\n    </div>\n  </form>\n</div>",o.prototype.options={},o.prototype.show=function(t){return e.Util.preventEventDefault(t),this.element.removeClass(this.classes.hide),this.element.find(".annotator-save").addClass(this.classes.focus),this.checkOrientation(),this.element.find(":input:first").focus(),this.setupDraggables(),this.publish("show")},o.prototype.hide=function(t){return e.Util.preventEventDefault(t),this.element.addClass(this.classes.hide),this.publish("hide")},o.prototype.load=function(t){var e,n,o,i;for(this.annotation=t,this.publish("load",[this.annotation]),i=this.fields,n=0,o=i.length;o>n;n++)e=i[n],e.load(e.element,this.annotation);return this.show()},o.prototype.submit=function(t){var n,o,i,r;for(e.Util.preventEventDefault(t),r=this.fields,o=0,i=r.length;i>o;o++)n=r[o],n.submit(n.element,this.annotation);return this.publish("save",[this.annotation]),this.hide()},o.prototype.addField=function(n){var o,i,r;switch(i=t.extend({id:"annotator-field-"+e.Util.uuid(),type:"input",label:"",load:function(){},submit:function(){}},n),r=null,o=t('<li class="annotator-item" />'),i.element=o[0],i.type){case"textarea":r=t("<textarea />");break;case"input":case"checkbox":r=t("<input />");break;case"select":r=t("<select />")}return o.append(r),r.attr({id:i.id,placeholder:i.label}),"checkbox"===i.type&&(r[0].type="checkbox",o.addClass("annotator-checkbox"),o.append(t("<label />",{"for":i.id,html:i.label}))),this.element.find("ul:first").append(o),this.fields.push(i),i.element},o.prototype.checkOrientation=function(){var t,e;return o.__super__.checkOrientation.apply(this,arguments),e=this.element.find("ul"),t=this.element.find(".annotator-controls"),this.element.hasClass(this.classes.invert.y)?t.insertBefore(e):t.is(":first-child")&&t.insertAfter(e),this},o.prototype.processKeypress=function(t){return 27===t.keyCode?this.hide():13!==t.keyCode||t.shiftKey?void 0:this.submit()},o.prototype.onCancelButtonMouseover=function(){return this.element.find("."+this.classes.focus).removeClass(this.classes.focus)},o.prototype.setupDraggables=function(){var e,n,o,i,r,s,a,l,u,h,d;return this.element.find(".annotator-resize").remove(),o=this.element.hasClass(this.classes.invert.y)?this.element.find(".annotator-item:last"):this.element.find(".annotator-item:first"),o&&t('<span class="annotator-resize"></span>').appendTo(o),r=null,e=this.classes,i=this.element,h=null,u=i.find(".annotator-resize"),n=i.find(".annotator-controls"),d=!1,s=function(e){return e.target===this?(r={element:this,top:e.pageY,left:e.pageX},h=i.find("textarea:first"),t(window).bind({"mouseup.annotator-editor-resize":l,"mousemove.annotator-editor-resize":a}),e.preventDefault()):void 0},l=function(){return r=null,t(window).unbind(".annotator-editor-resize")},a=function(t){var o,s,a,l,c;return r&&d===!1?(o={top:t.pageY-r.top,left:t.pageX-r.left},r.element===u[0]?(l=h.height(),c=h.width(),s=i.hasClass(e.invert.x)?-1:1,a=i.hasClass(e.invert.y)?1:-1,h.height(l+o.top*a),h.width(c+o.left*s),h.height()!==l&&(r.top=t.pageY),h.width()!==c&&(r.left=t.pageX)):r.element===n[0]&&(i.css({top:parseInt(i.css("top"),10)+o.top,left:parseInt(i.css("left"),10)+o.left}),r.top=t.pageY,r.left=t.pageX),d=!0,setTimeout(function(){return d=!1},1e3/60)):void 0},u.bind("mousedown",s),n.bind("mousedown",s)},o}(e.Widget),e.Viewer=function(n){function i(e){this.onDeleteClick=x(this.onDeleteClick,this),this.onEditClick=x(this.onEditClick,this),this.load=x(this.load,this),this.hide=x(this.hide,this),this.show=x(this.show,this),i.__super__.constructor.call(this,t(this.html.element)[0],e),this.item=t(this.html.item)[0],this.fields=[],this.annotations=[]}return T(i,n),i.prototype.events={".annotator-edit click":"onEditClick",".annotator-delete click":"onDeleteClick"},i.prototype.classes={hide:"annotator-hide",showControls:"annotator-visible"},i.prototype.html={element:'<div class="annotator-outer annotator-viewer">\n  <ul class="annotator-widget annotator-listing"></ul>\n</div>',item:'<li class="annotator-annotation annotator-item">\n  <span class="annotator-controls">\n    <a href="#" title="View as webpage" class="annotator-link">View as webpage</a>\n    <button title="Edit" class="annotator-edit">Edit</button>\n    <button title="Delete" class="annotator-delete">Delete</button>\n  </span>\n</li>'},i.prototype.options={readOnly:!1},i.prototype.show=function(t){var n,o=this;return e.Util.preventEventDefault(t),n=this.element.find(".annotator-controls").addClass(this.classes.showControls),setTimeout(function(){return n.removeClass(o.classes.showControls)},500),this.element.removeClass(this.classes.hide),this.checkOrientation().publish("show")},i.prototype.isShown=function(){return!this.element.hasClass(this.classes.hide)},i.prototype.hide=function(t){return e.Util.preventEventDefault(t),this.element.addClass(this.classes.hide),this.publish("hide")},i.prototype.load=function(e){var n,i,r,s,a,l,u,h,d,c,p,f,m,g,v,y,w;for(this.annotations=e||[],p=this.element.find("ul:first").empty(),y=this.annotations,f=0,g=y.length;g>f;f++)for(n=y[f],h=t(this.item).clone().appendTo(p).data("annotation",n),r=h.find(".annotator-controls"),d=r.find(".annotator-link"),a=r.find(".annotator-edit"),s=r.find(".annotator-delete"),c=new o(n.links||[]).get("alternate",{type:"text/html"}),0===c.length||null==c[0].href?d.remove():d.attr("href",c[0].href),this.options.readOnly?(a.remove(),s.remove()):i={showEdit:function(){return a.removeAttr("disabled")},hideEdit:function(){return a.attr("disabled","disabled")},showDelete:function(){return s.removeAttr("disabled")},hideDelete:function(){return s.attr("disabled","disabled")}},w=this.fields,m=0,v=w.length;v>m;m++)u=w[m],l=t(u.element).clone().appendTo(h)[0],u.load(l,n,i);return this.publish("load",[this.annotations]),
this.show()},i.prototype.addField=function(e){var n;return n=t.extend({load:function(){}},e),n.element=t("<div />")[0],this.fields.push(n),n.element,this},i.prototype.onEditClick=function(t){return this.onButtonClick(t,"edit")},i.prototype.onDeleteClick=function(t){return this.onButtonClick(t,"delete")},i.prototype.onButtonClick=function(e,n){var o;return o=t(e.target).parents(".annotator-annotation"),this.publish(n,[o.data("annotation")])},i}(e.Widget),o=function(){function e(t){this.data=t}return e.prototype.get=function(e,n){var o,i,r,s,a,l,u,h,d;for(null==n&&(n={}),n=t.extend({},n,{rel:e}),r=function(){var t;t=[];for(i in n)O.call(n,i)&&(a=n[i],t.push(i));return t}(),h=this.data,d=[],l=0,u=h.length;u>l;l++)o=h[l],s=r.reduce(function(t,e){return t&&o[e]===n[e]},!0),s&&d.push(o);return d},e}(),e=e||{},e.Notification=function(n){function o(e){this.hide=x(this.hide,this),this.show=x(this.show,this),o.__super__.constructor.call(this,t(this.options.html).appendTo(document.body)[0],e)}return T(o,n),o.prototype.events={click:"hide"},o.prototype.options={html:"<div class='annotator-notice'></div>",classes:{show:"annotator-notice-show",info:"annotator-notice-info",success:"annotator-notice-success",error:"annotator-notice-error"}},o.prototype.show=function(n,o){return null==o&&(o=e.Notification.INFO),this.currentStatus=o,t(this.element).addClass(this.options.classes.show).addClass(this.options.classes[this.currentStatus]).html(r.escape(n||"")),setTimeout(this.hide,5e3),this},o.prototype.hide=function(){return null==this.currentStatus&&(this.currentStatus=e.Notification.INFO),t(this.element).removeClass(this.options.classes.show).removeClass(this.options.classes[this.currentStatus]),this},o}(n),e.Notification.INFO="info",e.Notification.SUCCESS="success",e.Notification.ERROR="error",t(function(){var t;return t=new e.Notification,e.showNotification=t.show,e.hideNotification=t.hide})}).call(this),i("undefined"!=typeof Annotator?Annotator:window.Annotator)}).call(global,void 0,void 0,void 0,void 0,function(t){module.exports=t});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"jquery":"jquery"}],27:[function(require,module,exports){
function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var e=setTimeout(cleanUpNextTick);draining=!0;for(var n=queue.length;n;){for(currentQueue=queue,queue=[];++queueIndex<n;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,n=queue.length}currentQueue=null,draining=!1,clearTimeout(e)}}function Item(e,n){this.fun=e,this.array=n}function noop(){}var process=module.exports={},queue=[],draining=!1,currentQueue,queueIndex=-1;process.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];queue.push(new Item(e,n)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};

},{}],28:[function(require,module,exports){
!function(){"use strict";function e(){for(var r=[],o=0;o<arguments.length;o++){var f=arguments[o];if(f){var i=typeof f;if("string"===i||"number"===i)r.push(f);else if(Array.isArray(f))r.push(e.apply(null,f));else if("object"===i)for(var t in f)n.call(f,t)&&f[t]&&r.push(t)}}return r.join(" ")}var n={}.hasOwnProperty;"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],function(){return e}):window.classNames=e}();

},{}],29:[function(require,module,exports){
require("../../modules/es6.object.assign"),module.exports=require("../../modules/$.core").Object.assign;

},{"../../modules/$.core":32,"../../modules/es6.object.assign":47}],30:[function(require,module,exports){
module.exports=function(o){if("function"!=typeof o)throw TypeError(o+" is not a function!");return o};

},{}],31:[function(require,module,exports){
var toString={}.toString;module.exports=function(t){return toString.call(t).slice(8,-1)};

},{}],32:[function(require,module,exports){
var core=module.exports={version:"1.2.6"};"number"==typeof __e&&(__e=core);

},{}],33:[function(require,module,exports){
var aFunction=require("./$.a-function");module.exports=function(n,r,t){if(aFunction(n),void 0===r)return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,u){return n.call(r,t,u)};case 3:return function(t,u,e){return n.call(r,t,u,e)}}return function(){return n.apply(r,arguments)}};

},{"./$.a-function":30}],34:[function(require,module,exports){
module.exports=function(o){if(void 0==o)throw TypeError("Can't call method on  "+o);return o};

},{}],35:[function(require,module,exports){
module.exports=!require("./$.fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a});

},{"./$.fails":37}],36:[function(require,module,exports){
var global=require("./$.global"),core=require("./$.core"),hide=require("./$.hide"),redefine=require("./$.redefine"),ctx=require("./$.ctx"),PROTOTYPE="prototype",$export=function(e,r,o){var t,l,x,$,p=e&$export.F,i=e&$export.G,c=e&$export.S,a=e&$export.P,n=e&$export.B,P=i?global:c?global[r]||(global[r]={}):(global[r]||{})[PROTOTYPE],u=i?core:core[r]||(core[r]={}),b=u[PROTOTYPE]||(u[PROTOTYPE]={});i&&(o=r);for(t in o)l=!p&&P&&t in P,x=(l?P:o)[t],$=n&&l?ctx(x,global):a&&"function"==typeof x?ctx(Function.call,x):x,P&&!l&&redefine(P,t,x),u[t]!=x&&hide(u,t,$),a&&b[t]!=x&&(b[t]=x)};global.core=core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,module.exports=$export;

},{"./$.core":32,"./$.ctx":33,"./$.global":38,"./$.hide":39,"./$.redefine":44}],37:[function(require,module,exports){
module.exports=function(r){try{return!!r()}catch(t){return!0}};

},{}],38:[function(require,module,exports){
var global=module.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global);

},{}],39:[function(require,module,exports){
var $=require("./$"),createDesc=require("./$.property-desc");module.exports=require("./$.descriptors")?function(e,r,t){return $.setDesc(e,r,createDesc(1,t))}:function(e,r,t){return e[r]=t,e};

},{"./$":41,"./$.descriptors":35,"./$.property-desc":43}],40:[function(require,module,exports){
var cof=require("./$.cof");module.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==cof(e)?e.split(""):Object(e)};

},{"./$.cof":31}],41:[function(require,module,exports){
var $Object=Object;module.exports={create:$Object.create,getProto:$Object.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:$Object.getOwnPropertyDescriptor,setDesc:$Object.defineProperty,setDescs:$Object.defineProperties,getKeys:$Object.keys,getNames:$Object.getOwnPropertyNames,getSymbols:$Object.getOwnPropertySymbols,each:[].forEach};

},{}],42:[function(require,module,exports){
var $=require("./$"),toObject=require("./$.to-object"),IObject=require("./$.iobject");module.exports=require("./$.fails")(function(){var e=Object.assign,t={},r={},o=Symbol(),c="abcdefghijklmnopqrst";return t[o]=7,c.split("").forEach(function(e){r[e]=e}),7!=e({},t)[o]||Object.keys(e({},r)).join("")!=c})?function(e,t){for(var r=toObject(e),o=arguments,c=o.length,n=1,i=$.getKeys,b=$.getSymbols,s=$.isEnum;c>n;)for(var a,j=IObject(o[n++]),u=b?i(j).concat(b(j)):i(j),l=u.length,f=0;l>f;)s.call(j,a=u[f++])&&(r[a]=j[a]);return r}:Object.assign;

},{"./$":41,"./$.fails":37,"./$.iobject":40,"./$.to-object":45}],43:[function(require,module,exports){
module.exports=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}};

},{}],44:[function(require,module,exports){
var global=require("./$.global"),hide=require("./$.hide"),SRC=require("./$.uid")("src"),TO_STRING="toString",$toString=Function[TO_STRING],TPL=(""+$toString).split(TO_STRING);require("./$.core").inspectSource=function(t){return $toString.call(t)},(module.exports=function(t,e,i,n){"function"==typeof i&&(i.hasOwnProperty(SRC)||hide(i,SRC,t[e]?""+t[e]:TPL.join(String(e))),i.hasOwnProperty("name")||hide(i,"name",e)),t===global?t[e]=i:(n||delete t[e],hide(t,e,i))})(Function.prototype,TO_STRING,function(){return"function"==typeof this&&this[SRC]||$toString.call(this)});

},{"./$.core":32,"./$.global":38,"./$.hide":39,"./$.uid":46}],45:[function(require,module,exports){
var defined=require("./$.defined");module.exports=function(e){return Object(defined(e))};

},{"./$.defined":34}],46:[function(require,module,exports){
var id=0,px=Math.random();module.exports=function(o){return"Symbol(".concat(void 0===o?"":o,")_",(++id+px).toString(36))};

},{}],47:[function(require,module,exports){
var $export=require("./$.export");$export($export.S+$export.F,"Object",{assign:require("./$.object-assign")});

},{"./$.export":36,"./$.object-assign":42}],48:[function(require,module,exports){
"use strict";function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(t,e,n,i){"undefined"==typeof i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var h=i;if(null==t||null==e)throw new Error("Null input. (diff_main)");if(t==e)return t?[[DIFF_EQUAL,t]]:[];"undefined"==typeof n&&(n=!0);var r=n,a=this.diff_commonPrefix(t,e),f=t.substring(0,a);t=t.substring(a),e=e.substring(a),a=this.diff_commonSuffix(t,e);var s=t.substring(t.length-a);t=t.substring(0,t.length-a),e=e.substring(0,e.length-a);var l=this.diff_compute_(t,e,r,h);return f&&l.unshift([DIFF_EQUAL,f]),s&&l.push([DIFF_EQUAL,s]),this.diff_cleanupMerge(l),l},diff_match_patch.prototype.diff_compute_=function(t,e,n,i){var h;if(!t)return[[DIFF_INSERT,e]];if(!e)return[[DIFF_DELETE,t]];var r=t.length>e.length?t:e,a=t.length>e.length?e:t,f=r.indexOf(a);if(-1!=f)return h=[[DIFF_INSERT,r.substring(0,f)],[DIFF_EQUAL,a],[DIFF_INSERT,r.substring(f+a.length)]],t.length>e.length&&(h[0][0]=h[2][0]=DIFF_DELETE),h;if(1==a.length)return[[DIFF_DELETE,t],[DIFF_INSERT,e]];var s=this.diff_halfMatch_(t,e);if(s){var l=s[0],_=s[1],c=s[2],g=s[3],o=s[4],p=this.diff_main(l,c,n,i),u=this.diff_main(_,g,n,i);return p.concat([[DIFF_EQUAL,o]],u)}return n&&t.length>100&&e.length>100?this.diff_lineMode_(t,e,i):this.diff_bisect_(t,e,i)},diff_match_patch.prototype.diff_lineMode_=function(t,e,n){var i=this.diff_linesToChars_(t,e);t=i.chars1,e=i.chars2;var h=i.lineArray,r=this.diff_main(t,e,!1,n);this.diff_charsToLines_(r,h),this.diff_cleanupSemantic(r),r.push([DIFF_EQUAL,""]);for(var a=0,f=0,s=0,l="",_="";a<r.length;){switch(r[a][0]){case DIFF_INSERT:s++,_+=r[a][1];break;case DIFF_DELETE:f++,l+=r[a][1];break;case DIFF_EQUAL:if(f>=1&&s>=1){r.splice(a-f-s,f+s),a=a-f-s;for(var i=this.diff_main(l,_,!1,n),c=i.length-1;c>=0;c--)r.splice(a,0,i[c]);a+=i.length}s=0,f=0,l="",_=""}a++}return r.pop(),r},diff_match_patch.prototype.diff_bisect_=function(t,e,n){for(var i=t.length,h=e.length,r=Math.ceil((i+h)/2),a=r,f=2*r,s=new Array(f),l=new Array(f),_=0;f>_;_++)s[_]=-1,l[_]=-1;s[a+1]=0,l[a+1]=0;for(var c=i-h,g=c%2!=0,o=0,p=0,u=0,d=0,F=0;r>F&&!((new Date).getTime()>n);F++){for(var E=-F+o;F-p>=E;E+=2){var m,D=a+E;m=E==-F||E!=F&&s[D-1]<s[D+1]?s[D+1]:s[D-1]+1;for(var I=m-E;i>m&&h>I&&t.charAt(m)==e.charAt(I);)m++,I++;if(s[D]=m,m>i)p+=2;else if(I>h)o+=2;else if(g){var b=a+c-E;if(b>=0&&f>b&&-1!=l[b]){var v=i-l[b];if(m>=v)return this.diff_bisectSplit_(t,e,m,I,n)}}}for(var L=-F+u;F-d>=L;L+=2){var v,b=a+L;v=L==-F||L!=F&&l[b-1]<l[b+1]?l[b+1]:l[b-1]+1;for(var T=v-L;i>v&&h>T&&t.charAt(i-v-1)==e.charAt(h-T-1);)v++,T++;if(l[b]=v,v>i)d+=2;else if(T>h)u+=2;else if(!g){var D=a+c-L;if(D>=0&&f>D&&-1!=s[D]){var m=s[D],I=a+m-D;if(v=i-v,m>=v)return this.diff_bisectSplit_(t,e,m,I,n)}}}}return[[DIFF_DELETE,t],[DIFF_INSERT,e]]},diff_match_patch.prototype.diff_bisectSplit_=function(t,e,n,i,h){var r=t.substring(0,n),a=e.substring(0,i),f=t.substring(n),s=e.substring(i),l=this.diff_main(r,a,!1,h),_=this.diff_main(f,s,!1,h);return l.concat(_)},diff_match_patch.prototype.diff_linesToChars_=function(t,e){function n(t){for(var e="",n=0,r=-1,a=i.length;r<t.length-1;){r=t.indexOf("\n",n),-1==r&&(r=t.length-1);var f=t.substring(n,r+1);n=r+1,(h.hasOwnProperty?h.hasOwnProperty(f):void 0!==h[f])?e+=String.fromCharCode(h[f]):(e+=String.fromCharCode(a),h[f]=a,i[a++]=f)}return e}var i=[],h={};i[0]="";var r=n(t),a=n(e);return{chars1:r,chars2:a,lineArray:i}},diff_match_patch.prototype.diff_charsToLines_=function(t,e){for(var n=0;n<t.length;n++){for(var i=t[n][1],h=[],r=0;r<i.length;r++)h[r]=e[i.charCodeAt(r)];t[n][1]=h.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,i=Math.min(t.length,e.length),h=i,r=0;h>n;)t.substring(r,h)==e.substring(r,h)?(n=h,r=n):i=h,h=Math.floor((i-n)/2+n);return h},diff_match_patch.prototype.diff_commonSuffix=function(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,i=Math.min(t.length,e.length),h=i,r=0;h>n;)t.substring(t.length-h,t.length-r)==e.substring(e.length-h,e.length-r)?(n=h,r=n):i=h,h=Math.floor((i-n)/2+n);return h},diff_match_patch.prototype.diff_commonOverlap_=function(t,e){var n=t.length,i=e.length;if(0==n||0==i)return 0;n>i?t=t.substring(n-i):i>n&&(e=e.substring(0,n));var h=Math.min(n,i);if(t==e)return h;for(var r=0,a=1;;){var f=t.substring(h-a),s=e.indexOf(f);if(-1==s)return r;a+=s,0!=s&&t.substring(h-a)!=e.substring(0,a)||(r=a,a++)}},diff_match_patch.prototype.diff_halfMatch_=function(t,e){function n(t,e,n){for(var i,h,r,f,s=t.substring(n,n+Math.floor(t.length/4)),l=-1,_="";-1!=(l=e.indexOf(s,l+1));){var c=a.diff_commonPrefix(t.substring(n),e.substring(l)),g=a.diff_commonSuffix(t.substring(0,n),e.substring(0,l));_.length<g+c&&(_=e.substring(l-g,l)+e.substring(l,l+c),i=t.substring(0,n-g),h=t.substring(n+c),r=e.substring(0,l-g),f=e.substring(l+c))}return 2*_.length>=t.length?[i,h,r,f,_]:null}if(this.Diff_Timeout<=0)return null;var i=t.length>e.length?t:e,h=t.length>e.length?e:t;if(i.length<4||2*h.length<i.length)return null;var r,a=this,f=n(i,h,Math.ceil(i.length/4)),s=n(i,h,Math.ceil(i.length/2));if(!f&&!s)return null;r=s?f&&f[4].length>s[4].length?f:s:f;var l,_,c,g;t.length>e.length?(l=r[0],_=r[1],c=r[2],g=r[3]):(c=r[0],g=r[1],l=r[2],_=r[3]);var o=r[4];return[l,_,c,g,o]},diff_match_patch.prototype.diff_cleanupSemantic=function(t){for(var e=!1,n=[],i=0,h=null,r=0,a=0,f=0,s=0,l=0;r<t.length;)t[r][0]==DIFF_EQUAL?(n[i++]=r,a=s,f=l,s=0,l=0,h=t[r][1]):(t[r][0]==DIFF_INSERT?s+=t[r][1].length:l+=t[r][1].length,h&&h.length<=Math.max(a,f)&&h.length<=Math.max(s,l)&&(t.splice(n[i-1],0,[DIFF_DELETE,h]),t[n[i-1]+1][0]=DIFF_INSERT,i--,i--,r=i>0?n[i-1]:-1,a=0,f=0,s=0,l=0,h=null,e=!0)),r++;for(e&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),r=1;r<t.length;){if(t[r-1][0]==DIFF_DELETE&&t[r][0]==DIFF_INSERT){var _=t[r-1][1],c=t[r][1],g=this.diff_commonOverlap_(_,c),o=this.diff_commonOverlap_(c,_);g>=o?(g>=_.length/2||g>=c.length/2)&&(t.splice(r,0,[DIFF_EQUAL,c.substring(0,g)]),t[r-1][1]=_.substring(0,_.length-g),t[r+1][1]=c.substring(g),r++):(o>=_.length/2||o>=c.length/2)&&(t.splice(r,0,[DIFF_EQUAL,_.substring(0,o)]),t[r-1][0]=DIFF_INSERT,t[r-1][1]=c.substring(0,c.length-o),t[r+1][0]=DIFF_DELETE,t[r+1][1]=_.substring(o),r++),r++}r++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(t){function e(t,e){if(!t||!e)return 6;var n=t.charAt(t.length-1),i=e.charAt(0),h=n.match(diff_match_patch.nonAlphaNumericRegex_),r=i.match(diff_match_patch.nonAlphaNumericRegex_),a=h&&n.match(diff_match_patch.whitespaceRegex_),f=r&&i.match(diff_match_patch.whitespaceRegex_),s=a&&n.match(diff_match_patch.linebreakRegex_),l=f&&i.match(diff_match_patch.linebreakRegex_),_=s&&t.match(diff_match_patch.blanklineEndRegex_),c=l&&e.match(diff_match_patch.blanklineStartRegex_);return _||c?5:s||l?4:h&&!a&&f?3:a||f?2:h||r?1:0}for(var n=1;n<t.length-1;){if(t[n-1][0]==DIFF_EQUAL&&t[n+1][0]==DIFF_EQUAL){var i=t[n-1][1],h=t[n][1],r=t[n+1][1],a=this.diff_commonSuffix(i,h);if(a){var f=h.substring(h.length-a);i=i.substring(0,i.length-a),h=f+h.substring(0,h.length-a),r=f+r}for(var s=i,l=h,_=r,c=e(i,h)+e(h,r);h.charAt(0)===r.charAt(0);){i+=h.charAt(0),h=h.substring(1)+r.charAt(0),r=r.substring(1);var g=e(i,h)+e(h,r);g>=c&&(c=g,s=i,l=h,_=r)}t[n-1][1]!=s&&(s?t[n-1][1]=s:(t.splice(n-1,1),n--),t[n][1]=l,_?t[n+1][1]=_:(t.splice(n+1,1),n--))}n++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(t){for(var e=!1,n=[],i=0,h=null,r=0,a=!1,f=!1,s=!1,l=!1;r<t.length;)t[r][0]==DIFF_EQUAL?(t[r][1].length<this.Diff_EditCost&&(s||l)?(n[i++]=r,a=s,f=l,h=t[r][1]):(i=0,h=null),s=l=!1):(t[r][0]==DIFF_DELETE?l=!0:s=!0,h&&(a&&f&&s&&l||h.length<this.Diff_EditCost/2&&a+f+s+l==3)&&(t.splice(n[i-1],0,[DIFF_DELETE,h]),t[n[i-1]+1][0]=DIFF_INSERT,i--,h=null,a&&f?(s=l=!0,i=0):(i--,r=i>0?n[i-1]:-1,s=l=!1),e=!0)),r++;e&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_cleanupMerge=function(t){t.push([DIFF_EQUAL,""]);for(var e,n=0,i=0,h=0,r="",a="";n<t.length;)switch(t[n][0]){case DIFF_INSERT:h++,a+=t[n][1],n++;break;case DIFF_DELETE:i++,r+=t[n][1],n++;break;case DIFF_EQUAL:i+h>1?(0!==i&&0!==h&&(e=this.diff_commonPrefix(a,r),0!==e&&(n-i-h>0&&t[n-i-h-1][0]==DIFF_EQUAL?t[n-i-h-1][1]+=a.substring(0,e):(t.splice(0,0,[DIFF_EQUAL,a.substring(0,e)]),n++),a=a.substring(e),r=r.substring(e)),e=this.diff_commonSuffix(a,r),0!==e&&(t[n][1]=a.substring(a.length-e)+t[n][1],a=a.substring(0,a.length-e),r=r.substring(0,r.length-e))),0===i?t.splice(n-h,i+h,[DIFF_INSERT,a]):0===h?t.splice(n-i,i+h,[DIFF_DELETE,r]):t.splice(n-i-h,i+h,[DIFF_DELETE,r],[DIFF_INSERT,a]),n=n-i-h+(i?1:0)+(h?1:0)+1):0!==n&&t[n-1][0]==DIFF_EQUAL?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,h=0,i=0,r="",a=""}""===t[t.length-1][1]&&t.pop();var f=!1;for(n=1;n<t.length-1;)t[n-1][0]==DIFF_EQUAL&&t[n+1][0]==DIFF_EQUAL&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),f=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),f=!0)),n++;f&&this.diff_cleanupMerge(t)},diff_match_patch.prototype.diff_xIndex=function(t,e){var n,i=0,h=0,r=0,a=0;for(n=0;n<t.length&&(t[n][0]!==DIFF_INSERT&&(i+=t[n][1].length),t[n][0]!==DIFF_DELETE&&(h+=t[n][1].length),!(i>e));n++)r=i,a=h;return t.length!=n&&t[n][0]===DIFF_DELETE?a:a+(e-r)},diff_match_patch.prototype.diff_prettyHtml=function(t){for(var e=[],n=/&/g,i=/</g,h=/>/g,r=/\n/g,a=0;a<t.length;a++){var f=t[a][0],s=t[a][1],l=s.replace(n,"&amp;").replace(i,"&lt;").replace(h,"&gt;").replace(r,"&para;<br>");switch(f){case DIFF_INSERT:e[a]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case DIFF_DELETE:e[a]='<del style="background:#ffe6e6;">'+l+"</del>";break;case DIFF_EQUAL:e[a]="<span>"+l+"</span>"}}return e.join("")},diff_match_patch.prototype.diff_text1=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==DIFF_INSERT&&(e[n]=t[n][1]);return e.join("")},diff_match_patch.prototype.diff_text2=function(t){for(var e=[],n=0;n<t.length;n++)t[n][0]!==DIFF_DELETE&&(e[n]=t[n][1]);return e.join("")},diff_match_patch.prototype.diff_levenshtein=function(t){for(var e=0,n=0,i=0,h=0;h<t.length;h++){var r=t[h][0],a=t[h][1];switch(r){case DIFF_INSERT:n+=a.length;break;case DIFF_DELETE:i+=a.length;break;case DIFF_EQUAL:e+=Math.max(n,i),n=0,i=0}}return e+=Math.max(n,i)},diff_match_patch.prototype.diff_toDelta=function(t){for(var e=[],n=0;n<t.length;n++)switch(t[n][0]){case DIFF_INSERT:e[n]="+"+encodeURI(t[n][1]);break;case DIFF_DELETE:e[n]="-"+t[n][1].length;break;case DIFF_EQUAL:e[n]="="+t[n][1].length}return e.join("	").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(t,e){for(var n=[],i=0,h=0,r=e.split(/\t/g),a=0;a<r.length;a++){var f=r[a].substring(1);switch(r[a].charAt(0)){case"+":try{n[i++]=[DIFF_INSERT,decodeURI(f)]}catch(s){throw new Error("Illegal escape in diff_fromDelta: "+f)}break;case"-":case"=":var l=parseInt(f,10);if(isNaN(l)||0>l)throw new Error("Invalid number in diff_fromDelta: "+f);var _=t.substring(h,h+=l);"="==r[a].charAt(0)?n[i++]=[DIFF_EQUAL,_]:n[i++]=[DIFF_DELETE,_];break;default:if(r[a])throw new Error("Invalid diff operation in diff_fromDelta: "+r[a])}}if(h!=t.length)throw new Error("Delta length ("+h+") does not equal source text length ("+t.length+").");return n},diff_match_patch.prototype.match_main=function(t,e,n){if(null==t||null==e||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,t.length)),t==e?0:t.length?t.substring(n,n+e.length)==e?n:this.match_bitap_(t,e,n):-1},diff_match_patch.prototype.match_bitap_=function(t,e,n){function i(t,i){var h=t/e.length,a=Math.abs(n-i);return r.Match_Distance?h+a/r.Match_Distance:a?1:h}if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var h=this.match_alphabet_(e),r=this,a=this.Match_Threshold,f=t.indexOf(e,n);-1!=f&&(a=Math.min(i(0,f),a),f=t.lastIndexOf(e,n+e.length),-1!=f&&(a=Math.min(i(0,f),a)));var s=1<<e.length-1;f=-1;for(var l,_,c,g=e.length+t.length,o=0;o<e.length;o++){for(l=0,_=g;_>l;)i(o,n+_)<=a?l=_:g=_,_=Math.floor((g-l)/2+l);g=_;var p=Math.max(1,n-_+1),u=Math.min(n+_,t.length)+e.length,d=Array(u+2);d[u+1]=(1<<o)-1;for(var F=u;F>=p;F--){var E=h[t.charAt(F-1)];if(0===o?d[F]=(d[F+1]<<1|1)&E:d[F]=(d[F+1]<<1|1)&E|((c[F+1]|c[F])<<1|1)|c[F+1],d[F]&s){var m=i(o,F-1);if(a>=m){if(a=m,f=F-1,!(f>n))break;p=Math.max(1,2*n-f)}}}if(i(o+1,n)>a)break;c=d}return f},diff_match_patch.prototype.match_alphabet_=function(t){for(var e={},n=0;n<t.length;n++)e[t.charAt(n)]=0;for(var n=0;n<t.length;n++)e[t.charAt(n)]|=1<<t.length-n-1;return e},diff_match_patch.prototype.patch_addContext_=function(t,e){if(0!=e.length){for(var n=e.substring(t.start2,t.start2+t.length1),i=0;e.indexOf(n)!=e.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=e.substring(t.start2-i,t.start2+t.length1+i);i+=this.Patch_Margin;var h=e.substring(t.start2-i,t.start2);h&&t.diffs.unshift([DIFF_EQUAL,h]);var r=e.substring(t.start2+t.length1,t.start2+t.length1+i);r&&t.diffs.push([DIFF_EQUAL,r]),t.start1-=h.length,t.start2-=h.length,t.length1+=h.length+r.length,t.length2+=h.length+r.length}},diff_match_patch.prototype.patch_make=function(t,e,n){var i,h;if("string"==typeof t&&"string"==typeof e&&"undefined"==typeof n)i=t,h=this.diff_main(i,e,!0),h.length>2&&(this.diff_cleanupSemantic(h),this.diff_cleanupEfficiency(h));else if(t&&"object"==typeof t&&"undefined"==typeof e&&"undefined"==typeof n)h=t,i=this.diff_text1(h);else if("string"==typeof t&&e&&"object"==typeof e&&"undefined"==typeof n)i=t,h=e;else{if("string"!=typeof t||"string"!=typeof e||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");i=t,h=n}if(0===h.length)return[];for(var r=[],a=new diff_match_patch.patch_obj,f=0,s=0,l=0,_=i,c=i,g=0;g<h.length;g++){var o=h[g][0],p=h[g][1];switch(f||o===DIFF_EQUAL||(a.start1=s,a.start2=l),o){case DIFF_INSERT:a.diffs[f++]=h[g],a.length2+=p.length,c=c.substring(0,l)+p+c.substring(l);break;case DIFF_DELETE:a.length1+=p.length,a.diffs[f++]=h[g],c=c.substring(0,l)+c.substring(l+p.length);break;case DIFF_EQUAL:p.length<=2*this.Patch_Margin&&f&&h.length!=g+1?(a.diffs[f++]=h[g],a.length1+=p.length,a.length2+=p.length):p.length>=2*this.Patch_Margin&&f&&(this.patch_addContext_(a,_),r.push(a),a=new diff_match_patch.patch_obj,f=0,_=c,s=l)}o!==DIFF_INSERT&&(s+=p.length),o!==DIFF_DELETE&&(l+=p.length)}return f&&(this.patch_addContext_(a,_),r.push(a)),r},diff_match_patch.prototype.patch_deepCopy=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n],h=new diff_match_patch.patch_obj;h.diffs=[];for(var r=0;r<i.diffs.length;r++)h.diffs[r]=i.diffs[r].slice();h.start1=i.start1,h.start2=i.start2,h.length1=i.length1,h.length2=i.length2,e[n]=h}return e},diff_match_patch.prototype.patch_apply=function(t,e){if(0==t.length)return[e,[]];t=this.patch_deepCopy(t);var n=this.patch_addPadding(t);e=n+e+n,this.patch_splitMax(t);for(var i=0,h=[],r=0;r<t.length;r++){var a,f=t[r].start2+i,s=this.diff_text1(t[r].diffs),l=-1;if(s.length>this.Match_MaxBits?(a=this.match_main(e,s.substring(0,this.Match_MaxBits),f),-1!=a&&(l=this.match_main(e,s.substring(s.length-this.Match_MaxBits),f+s.length-this.Match_MaxBits),(-1==l||a>=l)&&(a=-1))):a=this.match_main(e,s,f),-1==a)h[r]=!1,i-=t[r].length2-t[r].length1;else{h[r]=!0,i=a-f;var _;if(_=-1==l?e.substring(a,a+s.length):e.substring(a,l+this.Match_MaxBits),s==_)e=e.substring(0,a)+this.diff_text2(t[r].diffs)+e.substring(a+s.length);else{var c=this.diff_main(s,_,!1);if(s.length>this.Match_MaxBits&&this.diff_levenshtein(c)/s.length>this.Patch_DeleteThreshold)h[r]=!1;else{this.diff_cleanupSemanticLossless(c);for(var g,o=0,p=0;p<t[r].diffs.length;p++){var u=t[r].diffs[p];u[0]!==DIFF_EQUAL&&(g=this.diff_xIndex(c,o)),u[0]===DIFF_INSERT?e=e.substring(0,a+g)+u[1]+e.substring(a+g):u[0]===DIFF_DELETE&&(e=e.substring(0,a+g)+e.substring(a+this.diff_xIndex(c,o+u[1].length))),u[0]!==DIFF_DELETE&&(o+=u[1].length)}}}}}return e=e.substring(n.length,e.length-n.length),[e,h]},diff_match_patch.prototype.patch_addPadding=function(t){for(var e=this.Patch_Margin,n="",i=1;e>=i;i++)n+=String.fromCharCode(i);for(var i=0;i<t.length;i++)t[i].start1+=e,t[i].start2+=e;var h=t[0],r=h.diffs;if(0==r.length||r[0][0]!=DIFF_EQUAL)r.unshift([DIFF_EQUAL,n]),h.start1-=e,h.start2-=e,h.length1+=e,h.length2+=e;else if(e>r[0][1].length){var a=e-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],h.start1-=a,h.start2-=a,h.length1+=a,h.length2+=a}if(h=t[t.length-1],r=h.diffs,0==r.length||r[r.length-1][0]!=DIFF_EQUAL)r.push([DIFF_EQUAL,n]),h.length1+=e,h.length2+=e;else if(e>r[r.length-1][1].length){var a=e-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,a),h.length1+=a,h.length2+=a}return n},diff_match_patch.prototype.patch_splitMax=function(t){for(var e=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=e)){var i=t[n];t.splice(n--,1);for(var h=i.start1,r=i.start2,a="";0!==i.diffs.length;){var f=new diff_match_patch.patch_obj,s=!0;for(f.start1=h-a.length,f.start2=r-a.length,""!==a&&(f.length1=f.length2=a.length,f.diffs.push([DIFF_EQUAL,a]));0!==i.diffs.length&&f.length1<e-this.Patch_Margin;){var l=i.diffs[0][0],_=i.diffs[0][1];l===DIFF_INSERT?(f.length2+=_.length,r+=_.length,f.diffs.push(i.diffs.shift()),s=!1):l===DIFF_DELETE&&1==f.diffs.length&&f.diffs[0][0]==DIFF_EQUAL&&_.length>2*e?(f.length1+=_.length,h+=_.length,s=!1,f.diffs.push([l,_]),i.diffs.shift()):(_=_.substring(0,e-f.length1-this.Patch_Margin),f.length1+=_.length,h+=_.length,l===DIFF_EQUAL?(f.length2+=_.length,r+=_.length):s=!1,f.diffs.push([l,_]),_==i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(_.length))}a=this.diff_text2(f.diffs),a=a.substring(a.length-this.Patch_Margin);var c=this.diff_text1(i.diffs).substring(0,this.Patch_Margin);""!==c&&(f.length1+=c.length,f.length2+=c.length,0!==f.diffs.length&&f.diffs[f.diffs.length-1][0]===DIFF_EQUAL?f.diffs[f.diffs.length-1][1]+=c:f.diffs.push([DIFF_EQUAL,c])),s||t.splice(++n,0,f)}}},diff_match_patch.prototype.patch_toText=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return e.join("")},diff_match_patch.prototype.patch_fromText=function(t){var e=[];if(!t)return e;for(var n=t.split("\n"),i=0,h=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<n.length;){var r=n[i].match(h);if(!r)throw new Error("Invalid patch string: "+n[i]);var a=new diff_match_patch.patch_obj;for(e.push(a),a.start1=parseInt(r[1],10),""===r[2]?(a.start1--,a.length1=1):"0"==r[2]?a.length1=0:(a.start1--,a.length1=parseInt(r[2],10)),a.start2=parseInt(r[3],10),""===r[4]?(a.start2--,a.length2=1):"0"==r[4]?a.length2=0:(a.start2--,a.length2=parseInt(r[4],10)),i++;i<n.length;){var f=n[i].charAt(0);try{var s=decodeURI(n[i].substring(1))}catch(l){throw new Error("Illegal escape in patch_fromText: "+s)}if("-"==f)a.diffs.push([DIFF_DELETE,s]);else if("+"==f)a.diffs.push([DIFF_INSERT,s]);else if(" "==f)a.diffs.push([DIFF_EQUAL,s]);else{if("@"==f)break;if(""!==f)throw new Error('Invalid patch mode "'+f+'" in: '+s)}i++}}return e},diff_match_patch.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},diff_match_patch.patch_obj.prototype.toString=function(){var t,e;t=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,e=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,i=["@@ -"+t+" +"+e+" @@\n"],h=0;h<this.diffs.length;h++){switch(this.diffs[h][0]){case DIFF_INSERT:n="+";break;case DIFF_DELETE:n="-";break;case DIFF_EQUAL:n=" "}i[h+1]=n+encodeURI(this.diffs[h][1])+"\n"}return i.join("").replace(/%20/g," ")},module.exports=diff_match_patch,module.exports.diff_match_patch=diff_match_patch,module.exports.DIFF_DELETE=DIFF_DELETE,module.exports.DIFF_INSERT=DIFF_INSERT,module.exports.DIFF_EQUAL=DIFF_EQUAL;

},{}],49:[function(require,module,exports){
module.exports=function(){var e=document.baseURI;if(!e)for(var t=document.getElementsByTagName("base"),n=0;n<t.length;n++)if(t[n].href){e=t[n].href;break}return e||document.documentURI}();

},{}],50:[function(require,module,exports){
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),FragmentAnchor=function(){function e(r,t){if(_classCallCheck(this,e),void 0===r)throw new Error('missing required parameter "root"');if(void 0===t)throw new Error('missing required parameter "id"');this.root=r,this.id=t}return _createClass(e,[{key:"toRange",value:function(){var e=this.root.querySelector("#"+this.id);if(null==e)throw new Error('no element found with id "'+this.id+'"');var r=this.root.ownerDocument.createRange();return r.selectNodeContents(e),r}},{key:"toSelector",value:function(){var e=this.root.querySelector("#"+this.id);if(null==e)throw new Error('no element found with id "'+this.id+'"');var r="https://tools.ietf.org/html/rfc3236";return e instanceof SVGElement&&(r="http://www.w3.org/TR/SVG/"),{type:"FragmentSelector",value:this.id,conformsTo:r}}}],[{key:"fromRange",value:function(r,t){if(void 0===r)throw new Error('missing required parameter "root"');if(void 0===t)throw new Error('missing required parameter "range"');for(var o=t.commonAncestorContainer;null!=o&&!o.id;){if(!(r.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINED_BY))throw new Error("no fragment identifier found");o=o.parentElement}return new e(r,o.id)}},{key:"fromSelector",value:function(r){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new e(r,t.value)}}]),e}();exports["default"]=FragmentAnchor,module.exports=exports["default"];

},{}],51:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getFirstTextNode(e){if(e.nodeType===Node.TEXT_NODE)return e;var t=e.ownerDocument,r=t.createTreeWalker(e,SHOW_TEXT,null,!1);return r.firstChild()}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_nodeIteratorShim=require("node-iterator-shim"),_nodeIteratorShim2=_interopRequireDefault(_nodeIteratorShim),_domSeek=require("dom-seek"),_domSeek2=_interopRequireDefault(_domSeek),SHOW_TEXT=NodeFilter.SHOW_TEXT,TextPositionAnchor=function(){function e(t,r,o){if(_classCallCheck(this,e),void 0===t)throw new Error('missing required parameter "root"');if(void 0===r)throw new Error('missing required parameter "start"');if(void 0===o)throw new Error('missing required parameter "end"');this.root=t,this.start=r,this.end=o}return _createClass(e,[{key:"toRange",value:function(){var e=this.root,t=e.ownerDocument,r=t.createRange(),o=(0,_nodeIteratorShim2["default"])(e,SHOW_TEXT),n=this.start,i=this.end,a=(0,_domSeek2["default"])(o,n),d=n-a;o.pointerBeforeReferenceNode?r.setStart(o.referenceNode,d):(r.setStart(o.nextNode(),d),o.previousNode());var s=i-n+d;return a=(0,_domSeek2["default"])(o,s),d=s-a,o.pointerBeforeReferenceNode?r.setEnd(o.referenceNode,d):r.setEnd(o.nextNode(),d),r}},{key:"toSelector",value:function(){return{type:"TextPositionSelector",start:this.start,end:this.end}}}],[{key:"fromRange",value:function(t,r){if(void 0===t)throw new Error('missing required parameter "root"');if(void 0===r)throw new Error('missing required parameter "range"');var o=r.startContainer,n=r.startOffset;o.nodeType!==Node.TEXT_NODE&&(n===o.childNodes.length?(o=o.childNodes[n-1],o=getFirstTextNode(o),n=o.textContent.length):(o=o.childNodes[n],o=getFirstTextNode(o),n=0));var i=r.endContainer,a=r.endOffset;i.nodeType!==Node.TEXT_NODE&&(a===i.childNodes.length?(i=i.childNodes[a-1],i=getFirstTextNode(i),a=i.textContent.length):(i=i.childNodes[a],i=getFirstTextNode(i),a=0));var d=(0,_nodeIteratorShim2["default"])(t,SHOW_TEXT),s=(0,_domSeek2["default"])(d,o),u=s+(0,_domSeek2["default"])(d,i);return new e(t,s+n,u+a)}},{key:"fromSelector",value:function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new e(t,r.start,r.end)}}]),e}();exports["default"]=TextPositionAnchor,module.exports=exports["default"];

},{"dom-seek":54,"node-iterator-shim":52}],52:[function(require,module,exports){
"use strict";function createNodeIterator(e,t){var r=arguments.length<=2||void 0===arguments[2]?null:arguments[2],o=e.ownerDocument,n=o.createNodeIterator(e,t,r,!1);return"undefined"==typeof n.referenceNode?shim(n,e):n}function shim(e,t){var r=t,o=!0;return Object.create(NodeIterator.prototype,{root:{get:function(){return e.root}},whatToShow:{get:function(){return e.whatToShow}},filter:{get:function(){return e.filter}},referenceNode:{get:function(){return r}},pointerBeforeReferenceNode:{get:function(){return o}},detach:{get:function(){return e.detach}},nextNode:{value:function(){var t=e.nextNode();return o=!1,null===t?null:r=t}},previousNode:{value:function(){var t=e.previousNode();return o=!0,null===t?null:r=t}}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=createNodeIterator,module.exports=exports["default"];

},{}],53:[function(require,module,exports){
"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_diffMatchPatch=require("diff-match-patch"),_diffMatchPatch2=_interopRequireDefault(_diffMatchPatch),_domAnchorTextPosition=require("dom-anchor-text-position"),_domAnchorTextPosition2=_interopRequireDefault(_domAnchorTextPosition),CONTEXT_LENGTH=32,TextQuoteAnchor=function(){function t(e,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(_classCallCheck(this,t),void 0===e)throw new Error('missing required parameter "root"');if(void 0===r)throw new Error('missing required parameter "exact"');this.root=e,this.exact=r,this.prefix=n.prefix,this.suffix=n.suffix}return _createClass(t,[{key:"toRange",value:function(t){return this.toPositionAnchor(t).toRange()}},{key:"toSelector",value:function(){var t={type:"TextQuoteSelector",exact:this.exact};return void 0!==this.prefix&&(t.prefix=this.prefix),void 0!==this.suffix&&(t.suffix=this.suffix),t}},{key:"toPositionAnchor",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.hint,r=this.root,n=new _diffMatchPatch2["default"];n.Match_Distance=2*r.textContent.length;var o=this.exact.match(/(.|[\r\n]){1,32}/g),i=void 0===e?r.textContent.length/2|0:e,a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,f=-1;void 0!==this.prefix&&(f=n.match_main(r.textContent,this.prefix,i),f>-1&&(i=f+this.prefix.length));var c=o.shift();if(f=n.match_main(r.textContent,c,i),!(f>-1))throw new Error("no match found");a=f,i=u=a+c.length;var s=function(t,e){var o=n.match_main(r.textContent,e,t.loc);if(-1===o)throw new Error("no match found");return t.loc=o+e.length,t.start=Math.min(t.start,o),t.end=Math.max(t.end,o+e.length),t};n.Match_Distance=64;var h=o.reduce(s,{start:a,end:u,loc:i});return new _domAnchorTextPosition2["default"](r,h.start,h.end)}}],[{key:"fromRange",value:function(t,e){if(void 0===e)throw new Error('missing required parameter "range"');var r=_domAnchorTextPosition2["default"].fromRange(t,e);return this.fromPositionAnchor(r)}},{key:"fromSelector",value:function(e){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new t(e,r.exact,r)}},{key:"fromPositionAnchor",value:function(e){var r=e.root,n=e.start,o=e.end,i=r.textContent.substr(n,o-n),a=Math.max(0,n-CONTEXT_LENGTH),u=r.textContent.substr(a,n-a),f=Math.min(r.textContent.length,o+CONTEXT_LENGTH),c=r.textContent.substr(o,f-o);return new t(r,i,{prefix:u,suffix:c})}}]),t}();exports["default"]=TextQuoteAnchor,module.exports=exports["default"];

},{"diff-match-patch":48,"dom-anchor-text-position":51}],54:[function(require,module,exports){
"use strict";function seek(e,r){if(e.whatToShow!==NodeFilter.SHOW_TEXT)throw new Error(E_SHOW);var t=0,o=e.referenceNode,n=null;if(isNumber(r))n={forward:function(){return r>t},backward:function(){return t>r}};else{if(!isText(r))throw new Error(E_WHERE);n={forward:function(){return before(o,r)},backward:function(){return!e.pointerBeforeReferenceNode||after(o,r)}}}for(;n.forward()&&null!==(o=e.nextNode());)t+=o.textContent.length;for(;n.backward()&&null!==(o=e.previousNode());)t-=o.textContent.length;return t}function isNumber(e){return!isNaN(parseInt(e))&&isFinite(e)}function isText(e){return e.nodeType===Node.TEXT_NODE}function before(e,r){return r.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_PRECEDING}function after(e,r){return r.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=seek;var E_SHOW="Argument 1 of seek must use filter NodeFilter.SHOW_TEXT.",E_WHERE="Argument 2 of seek must be a number or a Text Node.";module.exports=exports["default"];

},{}],55:[function(require,module,exports){
var hasOwn=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,undefined,isArray=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===toStr.call(t)},isPlainObject=function(t){"use strict";if(!t||"[object Object]"!==toStr.call(t))return!1;var r=hasOwn.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&hasOwn.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!o)return!1;var n;for(n in t);return n===undefined||hasOwn.call(t,n)};module.exports=function t(){"use strict";var r,o,n,e,c,i,a=arguments[0],s=1,u=arguments.length,l=!1;for("boolean"==typeof a?(l=a,a=arguments[1]||{},s=2):("object"!=typeof a&&"function"!=typeof a||null==a)&&(a={});u>s;++s)if(r=arguments[s],null!=r)for(o in r)n=a[o],e=r[o],a!==e&&(l&&e&&(isPlainObject(e)||(c=isArray(e)))?(c?(c=!1,i=n&&isArray(n)?n:[]):i=n&&isPlainObject(n)?n:{},a[o]=t(l,i,e)):e!==undefined&&(a[o]=e));return a};

},{}],56:[function(require,module,exports){
(function (global){
var __browserify_shim_require__=require;(function(t,e,i,n,r){!function(e,i,r,s){"use strict";function o(t,e,i){return setTimeout(l(t,i),e)}function a(t,e,i){return Array.isArray(t)?(u(t,i[e],i),!0):!1}function u(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function h(t,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=e.console&&(e.console.warn||e.console.log);return s&&s.call(e.console,r,n),t.apply(this,arguments)}}function c(t,e,i){var n,r=e.prototype;n=t.prototype=Object.create(r),n.constructor=t,n._super=r,i&&ft(n,i)}function l(t,e){return function(){return t.apply(e,arguments)}}function p(t,e){return typeof t==mt?t.apply(e?e[0]||s:s,e):t}function f(t,e){return t===s?e:t}function v(t,e,i){u(y(e),function(e){t.addEventListener(e,i,!1)})}function d(t,e,i){u(y(e),function(e){t.removeEventListener(e,i,!1)})}function m(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function g(t,e){return t.indexOf(e)>-1}function y(t){return t.trim().split(/\s+/g)}function T(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function E(t){return Array.prototype.slice.call(t,0)}function I(t,e,i){for(var n=[],r=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];T(r,o)<0&&n.push(t[s]),r[s]=o,s++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function _(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),o=0;o<vt.length;){if(i=vt[o],n=i?i+r:e,n in t)return n;o++}return s}function A(){return _t++}function b(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}function C(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){p(t.options.enable,[t])&&i.handler(e)},this.init()}function S(t){var e,i=t.options.inputClass;return new(e=i?i:Ct?H:St?L:bt?V:q)(t,P)}function P(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,s=e&Rt&&n-r===0,o=e&(zt|Nt)&&n-r===0;i.isFirst=!!s,i.isFinal=!!o,s&&(t.session={}),i.eventType=e,D(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function D(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=O(e)),r>1&&!i.firstMultiple?i.firstMultiple=O(e):1===r&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,a=o?o.center:s.center,u=e.center=R(n);e.timeStamp=Tt(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=X(a,u),e.distance=N(a,u),w(i,e),e.offsetDirection=z(e.deltaX,e.deltaY);var h=M(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=h.x,e.overallVelocityY=h.y,e.overallVelocity=yt(h.x)>yt(h.y)?h.x:h.y,e.scale=o?F(o.pointers,n):1,e.rotation=o?Y(o.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,x(i,e);var c=t.element;m(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}function w(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};e.eventType!==Rt&&s.eventType!==zt||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}function x(t,e){var i,n,r,o,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(e.eventType!=Nt&&(u>Ot||a.velocity===s)){var h=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,l=M(u,h,c);n=l.x,r=l.y,i=yt(l.x)>yt(l.y)?l.x:l.y,o=z(h,c),t.lastInterval=e}else i=a.velocity,n=a.velocityX,r=a.velocityY,o=a.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=o}function O(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:gt(t.pointers[i].clientX),clientY:gt(t.pointers[i].clientY)},i++;return{timeStamp:Tt(),pointers:e,center:R(e),deltaX:t.deltaX,deltaY:t.deltaY}}function R(t){var e=t.length;if(1===e)return{x:gt(t[0].clientX),y:gt(t[0].clientY)};for(var i=0,n=0,r=0;e>r;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:gt(i/e),y:gt(n/e)}}function M(t,e,i){return{x:e/t||0,y:i/t||0}}function z(t,e){return t===e?Xt:yt(t)>=yt(e)?0>t?Yt:Ft:0>e?qt:Ht}function N(t,e,i){i||(i=Ut);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function X(t,e,i){i||(i=Ut);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function Y(t,e){return X(e[1],e[0],Vt)+X(t[1],t[0],Vt)}function F(t,e){return N(e[0],e[1],Vt)/N(t[0],t[1],Vt)}function q(){this.evEl=Gt,this.evWin=Zt,this.pressed=!1,C.apply(this,arguments)}function H(){this.evEl=Jt,this.evWin=Kt,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function W(){this.evTarget=te,this.evWin=ee,this.started=!1,C.apply(this,arguments)}function k(t,e){var i=E(t.touches),n=E(t.changedTouches);return e&(zt|Nt)&&(i=I(i.concat(n),"identifier",!0)),[i,n]}function L(){this.evTarget=ne,this.targetIds={},C.apply(this,arguments)}function U(t,e){var i=E(t.touches),n=this.targetIds;if(e&(Rt|Mt)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s,o=E(t.changedTouches),a=[],u=this.target;if(s=i.filter(function(t){return m(t.target,u)}),e===Rt)for(r=0;r<s.length;)n[s[r].identifier]=!0,r++;for(r=0;r<o.length;)n[o[r].identifier]&&a.push(o[r]),e&(zt|Nt)&&delete n[o[r].identifier],r++;return a.length?[I(s.concat(a),"identifier",!0),a]:void 0}function V(){C.apply(this,arguments);var t=l(this.handler,this);this.touch=new L(this.manager,t),this.mouse=new q(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function j(t,e){t&Rt?(this.primaryTouch=e.changedPointers[0].identifier,G.call(this,e)):t&(zt|Nt)&&G.call(this,e)}function G(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches,r=function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)};setTimeout(r,re)}}function Z(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],s=Math.abs(e-r.x),o=Math.abs(i-r.y);if(se>=s&&se>=o)return!0}return!1}function B(t,e){this.manager=t,this.set(e)}function $(t){if(g(t,le))return le;var e=g(t,pe),i=g(t,fe);return e&&i?le:e||i?e?pe:fe:g(t,ce)?ce:he}function J(){if(!ae)return!1;var t={},i=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=i?e.CSS.supports("touch-action",n):!0}),t}function K(t){this.options=ft({},this.defaults,t||{}),this.id=A(),this.manager=null,this.options.enable=f(this.options.enable,!0),this.state=de,this.simultaneous={},this.requireFail=[]}function Q(t){return t&Ee?"cancel":t&ye?"end":t&ge?"move":t&me?"start":""}function tt(t){return t==Ht?"down":t==qt?"up":t==Yt?"left":t==Ft?"right":""}function et(t,e){var i=e.manager;return i?i.get(t):t}function it(){K.apply(this,arguments)}function nt(){it.apply(this,arguments),this.pX=null,this.pY=null}function rt(){it.apply(this,arguments)}function st(){K.apply(this,arguments),this._timer=null,this._input=null}function ot(){it.apply(this,arguments)}function at(){it.apply(this,arguments)}function ut(){K.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ht(t,e){return e=e||{},e.recognizers=f(e.recognizers,ht.defaults.preset),new ct(t,e)}function ct(t,e){this.options=ft({},ht.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=S(this),this.touchAction=new B(this,this.options.touchAction),lt(this,!0),u(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function lt(t,e){var i=t.element;if(i.style){var n;u(t.options.cssProps,function(r,s){n=_(i.style,s),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={})}}function pt(t,e){var n=i.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}var ft,vt=["","webkit","Moz","MS","ms","o"],dt=i.createElement("div"),mt="function",gt=Math.round,yt=Math.abs,Tt=Date.now;ft="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==s&&null!==n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}:Object.assign;var Et=h(function(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===s)&&(t[n[r]]=e[n[r]]),r++;return t},"extend","Use `assign`."),It=h(function(t,e){return Et(t,e,!0)},"merge","Use `assign`."),_t=1,At=/mobile|tablet|ip(ad|hone|od)|android/i,bt="ontouchstart"in e,Ct=_(e,"PointerEvent")!==s,St=bt&&At.test(navigator.userAgent),Pt="touch",Dt="pen",wt="mouse",xt="kinect",Ot=25,Rt=1,Mt=2,zt=4,Nt=8,Xt=1,Yt=2,Ft=4,qt=8,Ht=16,Wt=Yt|Ft,kt=qt|Ht,Lt=Wt|kt,Ut=["x","y"],Vt=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(b(this.element),this.evWin,this.domHandler)}};var jt={mousedown:Rt,mousemove:Mt,mouseup:zt},Gt="mousedown",Zt="mousemove mouseup";c(q,C,{handler:function(t){var e=jt[t.type];e&Rt&&0===t.button&&(this.pressed=!0),e&Mt&&1!==t.which&&(e=zt),this.pressed&&(e&zt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:wt,srcEvent:t}))}});var Bt={pointerdown:Rt,pointermove:Mt,pointerup:zt,pointercancel:Nt,pointerout:Nt},$t={2:Pt,3:Dt,4:wt,5:xt},Jt="pointerdown",Kt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Jt="MSPointerDown",Kt="MSPointerMove MSPointerUp MSPointerCancel"),c(H,C,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=Bt[n],s=$t[t.pointerType]||t.pointerType,o=s==Pt,a=T(e,t.pointerId,"pointerId");r&Rt&&(0===t.button||o)?0>a&&(e.push(t),a=e.length-1):r&(zt|Nt)&&(i=!0),0>a||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(a,1))}});var Qt={touchstart:Rt,touchmove:Mt,touchend:zt,touchcancel:Nt},te="touchstart",ee="touchstart touchmove touchend touchcancel";c(W,C,{handler:function(t){var e=Qt[t.type];if(e===Rt&&(this.started=!0),this.started){var i=k.call(this,t,e);e&(zt|Nt)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:Pt,srcEvent:t})}}});var ie={touchstart:Rt,touchmove:Mt,touchend:zt,touchcancel:Nt},ne="touchstart touchmove touchend touchcancel";c(L,C,{handler:function(t){var e=ie[t.type],i=U.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:Pt,srcEvent:t})}});var re=2500,se=25;c(V,C,{handler:function(t,e,i){var n=i.pointerType==Pt,r=i.pointerType==wt;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)j.call(this,e,i);else if(r&&Z.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var oe=_(dt.style,"touchAction"),ae=oe!==s,ue="compute",he="auto",ce="manipulation",le="none",pe="pan-x",fe="pan-y",ve=J();B.prototype={set:function(t){t==ue&&(t=this.compute()),ae&&this.manager.element.style&&ve[t]&&(this.manager.element.style[oe]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return u(this.manager.recognizers,function(e){p(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),$(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,r=g(n,le)&&!ve[le],s=g(n,fe)&&!ve[fe],o=g(n,pe)&&!ve[pe];if(r){var a=1===t.pointers.length,u=t.distance<2,h=t.deltaTime<250;if(a&&u&&h)return}return o&&s?void 0:r||s&&i&Wt||o&&i&kt?this.preventSrc(e):void 0},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var de=1,me=2,ge=4,ye=8,Te=ye,Ee=16,Ie=32;K.prototype={defaults:{},set:function(t){return ft(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(a(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=et(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return a(t,"dropRecognizeWith",this)?this:(t=et(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(a(t,"requireFailure",this))return this;var e=this.requireFail;return t=et(t,this),-1===T(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(a(t,"dropRequireFailure",this))return this;t=et(t,this);var e=T(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(e,t)}var i=this,n=this.state;ye>n&&e(i.options.event+Q(n)),e(i.options.event),t.additionalEvent&&e(t.additionalEvent),n>=ye&&e(i.options.event+Q(n))},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=Ie)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Ie|de)))return!1;t++}return!0},recognize:function(t){var e=ft({},t);return p(this.options.enable,[this,e])?(this.state&(Te|Ee|Ie)&&(this.state=de),this.state=this.process(e),void(this.state&(me|ge|ye|Ee)&&this.tryEmit(e))):(this.reset(),void(this.state=Ie))},process:function(t){},getTouchAction:function(){},reset:function(){}},c(it,K,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(me|ge),r=this.attrTest(t);return n&&(i&Nt||!r)?e|Ee:n||r?i&zt?e|ye:e&me?e|ge:me:Ie}}),c(nt,it,{defaults:{event:"pan",threshold:10,pointers:1,direction:Lt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Wt&&e.push(fe),t&kt&&e.push(pe),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&Wt?(r=0===s?Xt:0>s?Yt:Ft,i=s!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?Xt:0>o?qt:Ht,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return it.prototype.attrTest.call(this,t)&&(this.state&me||!(this.state&me)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=tt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),c(rt,it,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[le]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&me)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),c(st,K,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(zt|Nt)&&!r)this.reset();else if(t.eventType&Rt)this.reset(),this._timer=o(function(){this.state=Te,this.tryEmit()},e.time,this);else if(t.eventType&zt)return Te;return Ie},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Te&&(t&&t.eventType&zt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=Tt(),this.manager.emit(this.options.event,this._input)))}}),c(ot,it,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[le]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&me)}}),c(at,it,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Wt|kt,pointers:1},getTouchAction:function(){return nt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Wt|kt)?e=t.overallVelocity:i&Wt?e=t.overallVelocityX:i&kt&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&yt(e)>this.options.velocity&&t.eventType&zt},emit:function(t){var e=tt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),c(ut,K,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ce]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&Rt&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=zt)return this.failTimeout();var s=this.pTime?t.timeStamp-this.pTime<e.interval:!0,a=!this.pCenter||N(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&s?this.count+=1:this.count=1,this._input=t;var u=this.count%e.taps;if(0===u)return this.hasRequireFailures()?(this._timer=o(function(){this.state=Te,this.tryEmit()},e.interval,this),me):Te}return Ie},failTimeout:function(){return this._timer=o(function(){this.state=Ie},this.options.interval,this),Ie},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Te&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ht.VERSION="2.0.7",ht.defaults={domEvents:!1,touchAction:ue,enable:!0,inputTarget:null,inputClass:null,preset:[[ot,{enable:!1}],[rt,{enable:!1},["rotate"]],[at,{direction:Wt}],[nt,{direction:Wt},["swipe"]],[ut],[ut,{event:"doubletap",taps:2},["tap"]],[st]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var _e=1,Ae=2;ct.prototype={set:function(t){return ft(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?Ae:_e},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Te)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],e.stopped===Ae||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(me|ge|ye)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof K)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(a(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(a(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=T(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var i=this.handlers;return u(y(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==s){var i=this.handlers;return u(y(t),function(t){e?i[t]&&i[t].splice(T(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&pt(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&lt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ft(ht,{INPUT_START:Rt,INPUT_MOVE:Mt,INPUT_END:zt,INPUT_CANCEL:Nt,STATE_POSSIBLE:de,STATE_BEGAN:me,STATE_CHANGED:ge,STATE_ENDED:ye,STATE_RECOGNIZED:Te,STATE_CANCELLED:Ee,STATE_FAILED:Ie,DIRECTION_NONE:Xt,DIRECTION_LEFT:Yt,DIRECTION_RIGHT:Ft,DIRECTION_UP:qt,DIRECTION_DOWN:Ht,DIRECTION_HORIZONTAL:Wt,DIRECTION_VERTICAL:kt,DIRECTION_ALL:Lt,Manager:ct,Input:C,TouchAction:B,TouchInput:L,MouseInput:q,PointerEventInput:H,TouchMouseInput:V,SingleTouchInput:W,Recognizer:K,AttrRecognizer:it,Tap:ut,Pan:nt,Swipe:at,Pinch:rt,Rotate:ot,Press:st,on:v,off:d,each:u,merge:It,extend:Et,assign:ft,inherit:c,bindFn:l,prefixed:_});var be="undefined"!=typeof e?e:"undefined"!=typeof self?self:{};be.Hammer=ht,"function"==typeof n&&n.amd?n(function(){return ht}):"undefined"!=typeof t&&t.exports?t.exports=ht:e[r]=ht}(window,document,"Hammer"),r("undefined"!=typeof Hammer?Hammer:window.Hammer)}).call(global,void 0,void 0,void 0,void 0,function(t){module.exports=t});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],57:[function(require,module,exports){
"use strict";var strictUriEncode=require("strict-uri-encode");exports.extract=function(r){return r.split("?")[1]||""},exports.parse=function(r){return"string"!=typeof r?{}:(r=r.trim().replace(/^(\?|#|&)/,""),r?r.split("&").reduce(function(r,t){var e=t.replace(/\+/g," ").split("="),n=e.shift(),i=e.length>0?e.join("="):void 0;return n=decodeURIComponent(n),i=void 0===i?null:decodeURIComponent(i),r.hasOwnProperty(n)?Array.isArray(r[n])?r[n].push(i):r[n]=[r[n],i]:r[n]=i,r},{}):{})},exports.stringify=function(r){return r?Object.keys(r).sort().map(function(t){var e=r[t];return void 0===e?"":null===e?t:Array.isArray(e)?e.slice().sort().map(function(r){return strictUriEncode(t)+"="+strictUriEncode(r)}).join("&"):strictUriEncode(t)+"="+strictUriEncode(e)}).filter(function(r){return r.length>0}).join("&"):""};

},{"strict-uri-encode":58}],58:[function(require,module,exports){
"use strict";module.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})};

},{}],59:[function(require,module,exports){
(function (global){
for(var now=require("performance-now"),root="undefined"==typeof window?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix],i=0;!raf&&i<vendors.length;i++)raf=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(e){if(0===queue.length){var o=now(),a=Math.max(0,frameDuration-(o-last));last=a+o,setTimeout(function(){var e=queue.slice(0);queue.length=0;for(var o=0;o<e.length;o++)if(!e[o].cancelled)try{e[o].callback(last)}catch(a){setTimeout(function(){throw a},0)}},Math.round(a))}return queue.push({handle:++id,callback:e,cancelled:!1}),id},caf=function(e){for(var o=0;o<queue.length;o++)queue[o].handle===e&&(queue[o].cancelled=!0)}}module.exports=function(e){return raf.call(root,e)},module.exports.cancel=function(){caf.apply(root,arguments)},module.exports.polyfill=function(){root.requestAnimationFrame=raf,root.cancelAnimationFrame=caf};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"performance-now":60}],60:[function(require,module,exports){
(function (process){
(function(){var e,n,r;"undefined"!=typeof performance&&null!==performance&&performance.now?module.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(module.exports=function(){return(e()-r)/1e6},n=process.hrtime,e=function(){var e;return e=n(),1e9*e[0]+e[1]},r=e()):Date.now?(module.exports=function(){return Date.now()-r},r=Date.now()):(module.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this);

}).call(this,require('_process'))

},{"_process":27}],61:[function(require,module,exports){
function setElementScroll(t,e,n){t===window?t.scrollTo(e,n):(t.scrollLeft=e,t.scrollTop=n)}function getTargetScrollLocation(t,e,n){var i,l,o,r,a,c=t.getBoundingClientRect(),d=n&&null!=n.left?n.left:.5,s=n&&null!=n.top?n.top:.5,h=d,f=s;if(e===window)l=c.left+window.scrollX-window.innerWidth*h+Math.min(c.width,window.innerWidth)*h,o=c.top+window.scrollY-window.innerHeight*f+Math.min(c.height,window.innerHeight)*f,l=Math.max(Math.min(l,document.body.scrollWidth-window.innerWidth*h),0),o=Math.max(Math.min(o,document.body.scrollHeight-window.innerHeight*f),0),r=l-window.scrollX,a=o-window.scrollY;else{i=e.getBoundingClientRect();var g=c.top-(i.top-e.scrollTop),w=c.left-(i.left-e.scrollLeft);l=w+c.width*h-e.clientWidth*h,o=g+c.height*f-e.clientHeight*f,l=Math.max(Math.min(l,e.scrollWidth-e.clientWidth),0),o=Math.max(Math.min(o,e.scrollHeight-e.clientHeight),0),r=l-e.scrollLeft,a=o-e.scrollTop}return{x:l,y:o,differenceX:r,differenceY:a}}function animate(t){raf(function(){var e=t._scrollSettings;if(e){var n=getTargetScrollLocation(e.target,t,e.align),i=Date.now()-e.startTime,l=Math.min(1/e.time*i,1);if(i>e.time+20||Math.abs(n.differenceY)<=1&&Math.abs(n.differenceX)<=1)return setElementScroll(t,n.x,n.y),t._scrollSettings=null,e.end(COMPLETE);var o=l,r=l;setElementScroll(t,n.x-n.differenceX*Math.pow(1-o,o/2),n.y-n.differenceY*Math.pow(1-r,r/2)),animate(t)}})}function transitionScrollTo(t,e,n,i){function l(t){e._scrollSettings=null,i(t),e.removeEventListener("touchstart",l)}var o=!e._scrollSettings;e._scrollSettings&&e._scrollSettings.end(CANCELED),e._scrollSettings={startTime:Date.now(),target:t,time:n.time,ease:n.ease,align:n.align,end:l},e.addEventListener("touchstart",l.bind(null,CANCELED)),o&&animate(e)}var raf=require("raf"),COMPLETE="complete",CANCELED="canceled";module.exports=function(t,e,n){function i(t){o--,o||n&&n(t)}if(t){"function"==typeof e&&(n=e,e=null),e||(e={}),e.time=e.time||1e3,e.ease=e.ease||function(t){return t};for(var l=t.parentElement,o=0;l;){if((e.validTarget?e.validTarget(l,o):l===window||(l.scrollHeight!==l.clientHeight||l.scrollWidth!==l.clientWidth)&&"hidden"!==getComputedStyle(l).overflow)&&(o++,transitionScrollTo(t,l,e,i)),l=l.parentElement,!l)return;"BODY"===l.tagName&&(l=window)}}};

},{"raf":59}]},{},[11])
//# sourceMappingURL=injector.bundle.js.map
